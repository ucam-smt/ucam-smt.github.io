<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3"/>
<title>Cambridge SMT System: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Cambridge SMT System
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="rescoring"></a>
Rescoring Procedures</h1>
<h2><a class="anchor" id="rescoring_lm"></a>
Efficient Language Model Rescoring</h2>
<p>As discussed above, HiFST uses a lexicographic semiring (<a class="el" href="Basics.html#basic_scores">Scores, Costs, and Semirings</a>, [<a class="el" href="index.html#Roark2011">Roark2011</a>]) of two tropical weights. In each arc of a lattice generated by HiFST, the first weight (G+M) contains the correct score (translation grammar score + language model score). The second weight G only contains the translation grammar score. An example is repeated here: </p>
<pre class="fragment"> &gt; zcat output/exp.baseline/LATS/1.fst.gz | fstprint | head -n 10
 0 1    1                            1             -2.609375,-2.609375
 1 36   999999999                    999999999      29.5185547,29.5185547
 1 35   12198                        12198          19.6816635,7.27929688
 1 34   12198                        12198          17.9902573,5.58789062
 1 33   9227                         9227           16.845089,2.56347656
 1 32   9121                         9121           9.55193996,-1.04199219
 1 31   9121                         9121           7.86053371,-2.73339844
 1 30   9121                         9121           9.33318996,-1.26074219
 1 29   8559                         8559           14.9520674,4.25878906
 1 28   4608                         4608           17.6058693,4.88671875
</pre><p>The advantage of using the lexicographic semiring to represent (G+M,G) weights is that the language model score can be substracted very efficiently. HiFST binaries do this mapping internally with an <a href="http://www.openfst.org/twiki/bin/view/FST/ArcMapDoc">fstmap</a> operation. The result is a WFSA whose weights contain only the translation grammar scores (G,G). The lexmap tool can be used to do this mapping, as follows, yielding lexicographic weights (G,G): </p>
<pre class="fragment">  &gt; zcat output/exp.baseline.outputnoprune/LATS/1.fst.gz | lexmap.O2  | fstprint | head -n 10
  0  1 1    1                                               -2.609375,-2.609375
  1  36     999999999                                       999999999       29.5185547,29.5185547
  1  35     12198                                           12198           7.27929688,7.27929688
  1  34     12198                                           12198           5.58789062,5.58789062
  1  33     9227                                            9227            2.56347656,2.56347656
  1  32     9121                                            9121            -1.04199219,-1.04199219
  1  31     9121                                            9121            -2.73339844,-2.73339844
  1  30     9121                                            9121            -1.26074219,-1.26074219
  1  29     8559                                            8559            4.25878906,4.25878906
  1  28     4608                                            4608            4.88671875,4.88671875
</pre><p>Using this facility to remove language model scores, the HiFST applylm tool can be used to rescore lattices under a different language model than was used in first-pass translation. Operations are as follows:</p>
<ol type="1">
<li>A lattice with lexicographic (G+M,G) weights is loaded</li>
<li>Weights are converted to (G,G) via fstmap</li>
<li>The new language model(s) are applied via composition under the lexicographic semiring, with optional scale factors and word insertion penalties. The new WFSAs weights are of the form (G+M',G), where M' are the new language model weights.</li>
<li>The reweighted WFSA is written to disk, with either lexicographic or standard tropical weights</li>
</ol>
<p>The following example uses applylm to rescore lattices generated with almost no pruning (<code>output/exp.baseline.outputnoprune/LATS</code>). Rescoring uses the same 4-gram language model originally used to generate the lattice, but with a different scale factor (<code>lm.scale=0.9</code>). </p>
<pre class="fragment"> &gt; applylm.O2 --config=configs/CF.baseline.outputnoprune.lmrescore  &amp;&gt; log/log.lmrescore
</pre><p>For the first sentence, the original 1-best hypothesis was: </p>
<pre class="fragment">&gt; zcat output/exp.baseline.outputnoprune/LATS/1.fst.gz | printstrings.O2 --semiring=lexstdarc -m wmaps/wmt13.en.wmap -w 2&gt;/dev/null
&lt;s&gt; republican strategy of resistance to the renewal of obamas election &lt;/s&gt;        57.4707,-8.03809
</pre><p>Rescoring yields a slightly different 1-best: </p>
<pre class="fragment">&gt; zcat output/exp.baseline.lmrescore/LATS/1.fst.gz | printstrings.O2 --semiring=lexstdarc -m wmaps/wmt13.en.wmap -w 2&gt;/dev/null
&lt;s&gt; the republican strategy of resistance to the renewal of obamas election &lt;/s&gt;    50.9163,-8.66992
</pre><p>Note the "load.deletelmcost" option in the configuration file, which instructs the tool to subtract old lm scores first.</p>
<p>If the scaling is not changed, both lattices should be identical (<code>applylm.O2 --config=configs/CF.baseline.outputnoprune.lmrescore --lm.featureweights=1</code>). </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon May 26 2014 00:15:20 for Cambridge SMT System by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3
</small></address>
</body>
</html>
