<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Cambridge SMT System: common-helpers.hpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cambridge SMT System
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('common-helpers_8hpp_source.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">common-helpers.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="common-helpers_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#pragma once</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="registrypo_8hpp.html">registrypo.hpp</a>&gt;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="kenlmdetect_8hpp.html">kenlmdetect.hpp</a>&gt;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceucam.html">ucam</a> {</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">namespace </span>fsttools {</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keyword">template</span> &lt;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">template</span> &lt;<span class="keyword">class</span>&gt; class</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;            , <span class="keyword">class</span>&gt; <span class="keyword">class </span>TaskOneT</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  , template &lt;template &lt;class&gt; class</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;              , class&gt; class TaskTwoT</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  , template &lt;class&gt; class DataT</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  , class ArcT</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  &gt;</div><div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="structucam_1_1fsttools_1_1RunTask2.html">   22</a></span>&#160;struct <a class="code" href="structucam_1_1fsttools_1_1RunTask2.html">RunTask2</a> {</div><div class="line"><a name="l00023"></a><span class="lineno"><a class="line" href="structucam_1_1fsttools_1_1RunTask2.html#a811fd4443757f3338ee95395439f146a">   23</a></span>&#160;  <span class="keyword">explicit</span> <a class="code" href="structucam_1_1fsttools_1_1RunTask2.html#a811fd4443757f3338ee95395439f146a">RunTask2</a>(<a class="code" href="classucam_1_1util_1_1RegistryPO.html">util::RegistryPO</a> <span class="keyword">const</span> &amp;rg){</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <span class="keyword">using</span> <a class="code" href="classucam_1_1util_1_1Runner2.html">util::Runner2</a>;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  ( Runner2&lt;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    TaskOneT&lt; DataT, ArcT&gt;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    , TaskTwoT&lt; DataT, ArcT&gt;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    &gt;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    ( rg ) ) ();</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  }</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;};</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">template</span> &lt;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">template</span> &lt;<span class="keyword">class</span>&gt; class</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;            , <span class="keyword">class</span>&gt; <span class="keyword">class </span>TaskOneT</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  , template &lt;template &lt;class&gt; class</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;              , class&gt; class TaskTwoT</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  , template &lt;template &lt;class&gt; class</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;              , class&gt; class TaskThreeT</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  , template &lt;class&gt; class DataT</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  , class ArcT</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  &gt;</div><div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="structucam_1_1fsttools_1_1RunTask3.html">   48</a></span>&#160;struct <a class="code" href="structucam_1_1fsttools_1_1RunTask3.html">RunTask3</a> {</div><div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="structucam_1_1fsttools_1_1RunTask3.html#a2097d67e4f2b939f7dd4cb82ad26de1e">   49</a></span>&#160;  <span class="keyword">explicit</span> <a class="code" href="structucam_1_1fsttools_1_1RunTask3.html#a2097d67e4f2b939f7dd4cb82ad26de1e">RunTask3</a>(<a class="code" href="classucam_1_1util_1_1RegistryPO.html">util::RegistryPO</a> <span class="keyword">const</span> &amp;rg){</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keyword">using</span> <a class="code" href="classucam_1_1util_1_1Runner3.html">util::Runner3</a>;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  ( Runner3&lt;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    TaskOneT&lt; DataT, ArcT&gt;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    , TaskTwoT&lt; DataT, ArcT&gt;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    , TaskThreeT&lt; DataT, ArcT&gt;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    &gt;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    ( rg ) ) ();</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  }</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;};</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#ifdef KENLM_MAX_ORDER</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="keyword">template</span>&lt; <span class="keyword">template</span> &lt; <span class="keyword">template</span> &lt;<span class="keyword">class</span>, <span class="keyword">class</span>&gt; class</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                     , class</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                     , <span class="keyword">class</span>&gt; <span class="keyword">class </span>RunTaskT</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;          , template &lt;class, class&gt; class DataT</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;          , class ArcT</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;          &gt;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;inline void runTaskWithKenLMTemplate(ucam::<a class="code" href="classucam_1_1util_1_1RegistryPO.html">util::RegistryPO</a> const &amp;rg) {</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keyword">using namespace </span>lm::ngram;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="keyword">using namespace </span><a class="code" href="namespaceucam_1_1util.html">ucam::util</a>;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="comment">// Detect here kenlm binary type</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="comment">// it&#39;s a bit ugly this way of initializing the correct kenlm handler</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  ModelType kenmt = ucam::util::detectkenlm</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      (rg.getVectorString (<a class="code" href="namespaceHifstConstants.html#a37a650ce4c4cf67354de7b1466d60ae0">HifstConstants::kLmLoad</a>, 0) );</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keywordflow">switch</span> (kenmt) {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordflow">case</span> PROBING:</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      (RunTaskT&lt;DataT, ProbingModel, ArcT&gt;(rg));</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">case</span> REST_PROBING:</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      (RunTaskT&lt;DataT, RestProbingModel, ArcT&gt;(rg));</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keywordflow">case</span> TRIE:</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      (RunTaskT&lt;DataT, TrieModel, ArcT&gt;(rg));</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordflow">case</span> QUANT_TRIE:</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      (RunTaskT&lt;DataT, QuantTrieModel, ArcT&gt;(rg));</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordflow">case</span> ARRAY_TRIE:</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      (RunTaskT&lt;DataT, ArrayTrieModel, ArcT&gt;(rg));</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordflow">case</span> QUANT_ARRAY_TRIE:</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      (RunTaskT&lt;DataT, QuantArrayTrieModel, ArcT&gt;(rg));</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keywordflow">case</span> KENLM_NPLM:</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="preprocessor">#ifdef WITH_NPLM</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      (RunTaskT&lt;DataT, lm::np::Model, ArcT&gt;(rg));</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;Unsuported format: KENLM_NPLM. Did you compile NPLM library?&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    exit(EXIT_FAILURE);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  }</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;};</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}}  <span class="comment">// end namespaces</span></div><div class="ttc" id="kenlmdetect_8hpp_html"><div class="ttname"><a href="kenlmdetect_8hpp.html">kenlmdetect.hpp</a></div></div>
<div class="ttc" id="classucam_1_1util_1_1RegistryPO_html"><div class="ttname"><a href="classucam_1_1util_1_1RegistryPO.html">ucam::util::RegistryPO</a></div><div class="ttdef"><b>Definition:</b> <a href="registrypo_8hpp_source.html#l00095">registrypo.hpp:95</a></div></div>
<div class="ttc" id="classucam_1_1util_1_1Runner3_html"><div class="ttname"><a href="classucam_1_1util_1_1Runner3.html">ucam::util::Runner3</a></div><div class="ttdoc">Convenience wrapper class that can kick off three type of executions: singlethreaded, multithreaded, or server, triggered by program options. Possibly multithreading with 1 thread would do, but I keep both implementations as any plain bug that might arise will be easier to trace down with a single thread execution. The class is templated three functors, one for each type of execution Note that the details are up to the each of these functors. </div><div class="ttdef"><b>Definition:</b> <a href="multithreading_8helpers_8hpp_source.html#l00130">multithreading.helpers.hpp:130</a></div></div>
<div class="ttc" id="namespaceucam_1_1util_html"><div class="ttname"><a href="namespaceucam_1_1util.html">ucam::util</a></div><div class="ttdef"><b>Definition:</b> <a href="main_8applylm_8hpp_source.html#l00025">main.applylm.hpp:25</a></div></div>
<div class="ttc" id="structucam_1_1fsttools_1_1RunTask2_html"><div class="ttname"><a href="structucam_1_1fsttools_1_1RunTask2.html">ucam::fsttools::RunTask2</a></div><div class="ttdoc">Generic Runner2 class wrapper with the usual template structure required by the tasks in fsttools and...</div><div class="ttdef"><b>Definition:</b> <a href="common-helpers_8hpp_source.html#l00022">common-helpers.hpp:22</a></div></div>
<div class="ttc" id="structucam_1_1fsttools_1_1RunTask2_html_a811fd4443757f3338ee95395439f146a"><div class="ttname"><a href="structucam_1_1fsttools_1_1RunTask2.html#a811fd4443757f3338ee95395439f146a">ucam::fsttools::RunTask2::RunTask2</a></div><div class="ttdeci">RunTask2(util::RegistryPO const &amp;rg)</div><div class="ttdef"><b>Definition:</b> <a href="common-helpers_8hpp_source.html#l00023">common-helpers.hpp:23</a></div></div>
<div class="ttc" id="classucam_1_1util_1_1Runner2_html"><div class="ttname"><a href="classucam_1_1util_1_1Runner2.html">ucam::util::Runner2</a></div><div class="ttdoc">Convenience wrapper class that can kick off two type of executions: single or multithreaded, triggered by program options. Possibly multithreading with 1 thread would do, but I keep both implementations as any plain bug that might arise will be easier to trace down with a serialized execution (threadpool uses two, actually). The class is templated with two classes, one for single threading and another for multithreading. Note that the multithreading details are up to the second templated class. </div><div class="ttdef"><b>Definition:</b> <a href="multithreading_8helpers_8hpp_source.html#l00084">multithreading.helpers.hpp:84</a></div></div>
<div class="ttc" id="structucam_1_1fsttools_1_1RunTask3_html"><div class="ttname"><a href="structucam_1_1fsttools_1_1RunTask3.html">ucam::fsttools::RunTask3</a></div><div class="ttdoc">Generic Runner3 class wrapper with the usual template structure required by hifst. It can be used by other tools that should support a server mode (see Runner2/Runner3 details). </div><div class="ttdef"><b>Definition:</b> <a href="common-helpers_8hpp_source.html#l00048">common-helpers.hpp:48</a></div></div>
<div class="ttc" id="structucam_1_1fsttools_1_1RunTask3_html_a2097d67e4f2b939f7dd4cb82ad26de1e"><div class="ttname"><a href="structucam_1_1fsttools_1_1RunTask3.html#a2097d67e4f2b939f7dd4cb82ad26de1e">ucam::fsttools::RunTask3::RunTask3</a></div><div class="ttdeci">RunTask3(util::RegistryPO const &amp;rg)</div><div class="ttdef"><b>Definition:</b> <a href="common-helpers_8hpp_source.html#l00049">common-helpers.hpp:49</a></div></div>
<div class="ttc" id="namespaceHifstConstants_html_a37a650ce4c4cf67354de7b1466d60ae0"><div class="ttname"><a href="namespaceHifstConstants.html#a37a650ce4c4cf67354de7b1466d60ae0">HifstConstants::kLmLoad</a></div><div class="ttdeci">std::string const kLmLoad</div><div class="ttdef"><b>Definition:</b> <a href="constants-fsttools_8hpp_source.html#l00023">constants-fsttools.hpp:23</a></div></div>
<div class="ttc" id="registrypo_8hpp_html"><div class="ttname"><a href="registrypo_8hpp.html">registrypo.hpp</a></div><div class="ttdoc">Contains wrapper class RegistryPO, which uses boost::program_options to parse parameters, and provides methods to access them. </div></div>
<div class="ttc" id="namespaceucam_html"><div class="ttname"><a href="namespaceucam.html">ucam</a></div><div class="ttdef"><b>Definition:</b> <a href="bleu_8hpp_source.html#l00014">bleu.hpp:14</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_701c0c8b41b031e69113781f2f4e5321.html">ucam-smt</a></li><li class="navelem"><a class="el" href="dir_6c232e806e8d6cc2bbc4c32b14734fc5.html">cpp</a></li><li class="navelem"><a class="el" href="dir_db4241a08a3f066709bb61abf4b99f1e.html">fsttools</a></li><li class="navelem"><a class="el" href="dir_cfe80d0fe975d76ea8f1a64423722e9d.html">include</a></li><li class="navelem"><a class="el" href="common-helpers_8hpp.html">common-helpers.hpp</a></li>
    <li class="footer">Generated on Thu May 19 2016 11:47:02 for Cambridge SMT System by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
