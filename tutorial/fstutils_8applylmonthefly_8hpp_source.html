<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Cambridge SMT System: fstutils.applylmonthefly.hpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cambridge SMT System
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('fstutils_8applylmonthefly_8hpp_source.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">fstutils.applylmonthefly.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="fstutils_8applylmonthefly_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// you may not use these files except in compliance with the License.</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// You may obtain a copy of the License at</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">//    http://www.apache.org/licenses/LICENSE-2.0</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// Unless required by applicable law or agreed to in writing, software</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// See the License for the specific language governing permissions and</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// limitations under the License.</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// Copyright 2012 - Gonzalo Iglesias, Adri√† de Gispert, William Byrne</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#ifndef FSTUTILS_APPLYLMONTHEFLY_HPP</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#define FSTUTILS_APPLYLMONTHEFLY_HPP</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="idbridge_8hpp.html">idbridge.hpp</a>&gt;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;lm/wrappers/nplm.hh&gt;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacefst.html">fst</a> {</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> StateT&gt;</div><div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="structfst_1_1StateHandler.html">   31</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structfst_1_1StateHandler.html">StateHandler</a> {</div><div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="structfst_1_1StateHandler.html#acc607cb2f842e4ec200dcfc2f254438b">   32</a></span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="structfst_1_1StateHandler.html#acc607cb2f842e4ec200dcfc2f254438b">setLength</a>(<span class="keywordtype">unsigned</span> length) {}</div><div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="structfst_1_1StateHandler.html#a55e8e7017eb6a369918c480012f37864">   33</a></span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <a class="code" href="structfst_1_1StateHandler.html#a55e8e7017eb6a369918c480012f37864">getLength</a>(StateT <span class="keyword">const</span> &amp;state) { <span class="keywordflow">return</span> state.length;}</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;};</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">// specialization to handle nplm</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keyword">template</span>&lt;&gt;</div><div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="structfst_1_1StateHandler_3_01lm_1_1np_1_1State_01_4.html">   38</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structfst_1_1StateHandler.html">StateHandler</a>&lt;<a class="code" href="namespacelm.html">lm</a>::np::State&gt; {</div><div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="structfst_1_1StateHandler_3_01lm_1_1np_1_1State_01_4.html#a02b727f4ffd58d59057efa388769342b">   39</a></span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="structfst_1_1StateHandler_3_01lm_1_1np_1_1State_01_4.html#a02b727f4ffd58d59057efa388769342b">length_</a>;</div><div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="structfst_1_1StateHandler_3_01lm_1_1np_1_1State_01_4.html#aa441eeb89c4b2e8d2f44b11420ab238d">   40</a></span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="structfst_1_1StateHandler_3_01lm_1_1np_1_1State_01_4.html#aa441eeb89c4b2e8d2f44b11420ab238d">setLength</a>(<span class="keywordtype">unsigned</span> length) { length_ = length;}</div><div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="structfst_1_1StateHandler_3_01lm_1_1np_1_1State_01_4.html#adf6be20bd5601b30a8143019169047e6">   41</a></span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <a class="code" href="structfst_1_1StateHandler_3_01lm_1_1np_1_1State_01_4.html#adf6be20bd5601b30a8143019169047e6">getLength</a>(lm::np::State <span class="keyword">const</span> &amp;state)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> length_; }</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;};</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> StateT&gt;</div><div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="structfst_1_1Scale.html">   45</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structfst_1_1Scale.html">Scale</a> {</div><div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="structfst_1_1Scale.html#a3a0f73e16c82bcc515ad9a90e4791e85">   46</a></span>&#160;  <span class="keywordtype">float</span> <a class="code" href="structfst_1_1Scale.html#a3a0f73e16c82bcc515ad9a90e4791e85">scale_</a>;</div><div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="structfst_1_1Scale.html#a607cd6ae3dc803c19edd38100d3fdf2c">   47</a></span>&#160;  <a class="code" href="structfst_1_1Scale.html#a607cd6ae3dc803c19edd38100d3fdf2c">Scale</a>(<span class="keywordtype">float</span> scale): scale_(scale) {}</div><div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="structfst_1_1Scale.html#a143b48d78c9159f86a125a3d808d5abb">   48</a></span>&#160;  <span class="keywordtype">float</span> <a class="code" href="structfst_1_1Scale.html#a143b48d78c9159f86a125a3d808d5abb">operator()</a>(){</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordflow">return</span> scale_;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  }</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;};</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">// nplm in kenlm is providing by default</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">// natural logs, so correct this</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="keyword">template</span>&lt;&gt;</div><div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="structfst_1_1Scale_3_01lm_1_1np_1_1State_01_4.html">   56</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structfst_1_1Scale.html">Scale</a>&lt;<a class="code" href="namespacelm.html">lm</a>::np::State&gt; {</div><div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="structfst_1_1Scale_3_01lm_1_1np_1_1State_01_4.html#ae6c4c017b1a7542b13018363fb9ead97">   57</a></span>&#160;  <span class="keywordtype">float</span> <a class="code" href="structfst_1_1Scale_3_01lm_1_1np_1_1State_01_4.html#ae6c4c017b1a7542b13018363fb9ead97">scale_</a>;</div><div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="structfst_1_1Scale_3_01lm_1_1np_1_1State_01_4.html#a52df0fe823f963bdc7180fe76cb4d43e">   58</a></span>&#160;  <a class="code" href="structfst_1_1Scale_3_01lm_1_1np_1_1State_01_4.html#a52df0fe823f963bdc7180fe76cb4d43e">Scale</a>(<span class="keywordtype">float</span> scale): scale_(scale / ::log(10)) {}</div><div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="structfst_1_1Scale_3_01lm_1_1np_1_1State_01_4.html#aad8edbd4b83dbc6c1a230c03cb50dac1">   59</a></span>&#160;  <span class="keywordtype">float</span> <a class="code" href="structfst_1_1Scale_3_01lm_1_1np_1_1State_01_4.html#aad8edbd4b83dbc6c1a230c03cb50dac1">operator()</a>(){</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordflow">return</span> scale_;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  }</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;};</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">// This silly little hack allows to make it srilm-compatible</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">// i.e. log10 scores should always match</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">// assumes internal 1/2 numbers are &lt;s&gt; / &lt;/s&gt;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">// if you don&#39;t care, just implement a functor that does nothing</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">// and use it instead of this one</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> StateT&gt;</div><div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="structfst_1_1HackScore.html">   70</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structfst_1_1HackScore.html">HackScore</a> {</div><div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="structfst_1_1HackScore.html#aecd286f5fa7a690fa0a6e9bd4aa1d004">   71</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structfst_1_1HackScore.html#aecd286f5fa7a690fa0a6e9bd4aa1d004">operator()</a>(<span class="keywordtype">float</span> &amp;w, <span class="keywordtype">float</span> &amp;wp, <span class="keywordtype">unsigned</span> label, StateT&amp;) {</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">if</span> ( label &lt;= 2  )  {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      wp = 0;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      <span class="keywordflow">if</span> (label == 1 ) w = 0; <span class="comment">//get same result as srilm</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    }</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  }</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;};</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">// But nplm does not do exactly the same thing because</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">// the start state is actually different</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="keyword">template</span>&lt;&gt;</div><div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="structfst_1_1HackScore_3_01lm_1_1np_1_1State_01_4.html">   82</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structfst_1_1HackScore.html">HackScore</a>&lt;<a class="code" href="namespacelm.html">lm</a>::np::State&gt; {</div><div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="structfst_1_1HackScore_3_01lm_1_1np_1_1State_01_4.html#a1fb33f5d91af57ac7065511bac715602">   83</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structfst_1_1HackScore_3_01lm_1_1np_1_1State_01_4.html#a1fb33f5d91af57ac7065511bac715602">operator()</a>(<span class="keywordtype">float</span> &amp;w, <span class="keywordtype">float</span> &amp;wp, <span class="keywordtype">unsigned</span> label, lm::np::State &amp;ns) {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordflow">if</span> ( label &lt;= 2  )  {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      wp = 0;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      <span class="keywordflow">if</span> (label==1) {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        w = 0;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="comment">// set up correctly the next state</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; NPLM_MAX_ORDER - 1; ++k) {</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;          ns.words[k]=1;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        }</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      }</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    }</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  }</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;};</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> StateT&gt;</div><div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="structfst_1_1HackScoreBilingual.html">   98</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structfst_1_1HackScoreBilingual.html">HackScoreBilingual</a> {</div><div class="line"><a name="l00099"></a><span class="lineno"><a class="line" href="structfst_1_1HackScoreBilingual.html#a514d1f61dc0d249752efc980e1df20d8">   99</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structfst_1_1HackScoreBilingual.html#a514d1f61dc0d249752efc980e1df20d8">operator()</a>(<span class="keywordtype">float</span> &amp;w, <span class="keywordtype">float</span> &amp;wp, <span class="keywordtype">unsigned</span> label, StateT&amp;) {</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <a class="code" href="logger_8boost__log_8hpp.html#ad364e6e39b7970e4548d99dc3c0c68cc">LERROR</a>(<span class="stringliteral">&quot;Use only for nplm in bilingual models!&quot;</span>);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    exit(EXIT_FAILURE);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  }</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;};</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="keyword">template</span>&lt;&gt;</div><div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="structfst_1_1HackScoreBilingual_3_01lm_1_1np_1_1State_01_4.html">  107</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structfst_1_1HackScoreBilingual.html">HackScoreBilingual</a>&lt;<a class="code" href="namespacelm.html">lm</a>::np::State&gt; {</div><div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="structfst_1_1HackScoreBilingual_3_01lm_1_1np_1_1State_01_4.html#ab7c40ee234c5a8f9b1f9aa36ebc09986">  108</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structfst_1_1HackScoreBilingual_3_01lm_1_1np_1_1State_01_4.html#ab7c40ee234c5a8f9b1f9aa36ebc09986">operator()</a>(<span class="keywordtype">float</span> &amp;w, <span class="keywordtype">float</span> &amp;wp, <span class="keywordtype">unsigned</span> label, lm::np::State &amp;ns) {</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordflow">if</span> ( label &lt;= 2  )  {</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      wp = 0;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      <span class="keywordflow">if</span> (label==1) {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; NPLM_MAX_ORDER - 1; ++k) {</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;          ns.words[k]=1;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        }</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    }</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  }</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;};</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">// nplm states have size NPLM_MAX_ORDER - 1</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> StateT&gt;</div><div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="namespacefst.html#af2ba34587e640e012e10b00a65478e72">  122</a></span>&#160;std::string <a class="code" href="namespacefst.html#af2ba34587e640e012e10b00a65478e72">printDebug</a>(StateT <span class="keyword">const</span> &amp;state) {</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  std::string o =ucam::util::toString&lt;unsigned&gt;(state.words[0]);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> k = 1; k &lt; NPLM_MAX_ORDER - 1; ++k) {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    o += <span class="stringliteral">&quot;,&quot;</span> + ucam::util::toString&lt;unsigned&gt;(state.words[k]);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordflow">return</span> o;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;};</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class </span>StateT</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;         , <span class="keyword">class </span>KenLMModelT</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;         , <span class="keyword">class </span>IdBridgeT</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;         , <span class="keyword">template</span>&lt;<span class="keyword">class</span>&gt; <span class="keyword">class </span>HackScoreT</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;         &gt;</div><div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="structfst_1_1Scorer.html">  135</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structfst_1_1Scorer.html">Scorer</a> {</div><div class="line"><a name="l00136"></a><span class="lineno"><a class="line" href="structfst_1_1Scorer.html#acb88e86f68092eeabac8473cbb025048">  136</a></span>&#160;  IdBridgeT <span class="keyword">const</span>&amp; <a class="code" href="structfst_1_1Scorer.html#acb88e86f68092eeabac8473cbb025048">idbridge_</a>;</div><div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="structfst_1_1Scorer.html#ab626e61699d8ee8e5be62da78aba81cf">  137</a></span>&#160;  KenLMModelT&amp; <a class="code" href="structfst_1_1Scorer.html#ab626e61699d8ee8e5be62da78aba81cf">lmmodel_</a>;</div><div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="structfst_1_1Scorer.html#a3ca39ca9542c35e072c60220e80aec29">  138</a></span>&#160;  HackScoreT&lt;StateT&gt; <a class="code" href="structfst_1_1Scorer.html#a3ca39ca9542c35e072c60220e80aec29">hs_</a>;</div><div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="structfst_1_1Scorer.html#aa49f822e546e1a003c7b6d30e68f709c">  139</a></span>&#160;  <a class="code" href="structfst_1_1Scale.html">Scale&lt;StateT&gt;</a> &amp;<a class="code" href="structfst_1_1Scorer.html#aa49f822e546e1a003c7b6d30e68f709c">natlog10_</a>;</div><div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="structfst_1_1Scorer.html#aaea694bba2a0d629986c9732b5f3ee33">  140</a></span>&#160;  <span class="keyword">explicit</span> <a class="code" href="structfst_1_1Scorer.html#aaea694bba2a0d629986c9732b5f3ee33">Scorer</a>(KenLMModelT &amp;lmmodel</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                  , IdBridgeT <span class="keyword">const</span> &amp;idbridge</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                  , <a class="code" href="structfst_1_1Scale.html">Scale&lt;StateT&gt;</a> &amp;nl</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                  , <span class="keywordtype">unsigned</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                  , std::vector&lt;std::vector&lt;unsigned&gt; &gt; <span class="keyword">const</span> &amp;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                  )</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      : idbridge_(idbridge)</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      , lmmodel_(lmmodel)</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      , natlog10_(nl)</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">//    LERROR(&quot;Bilingual model scorer only works with nplm models&quot;);</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="comment">//    exit(EXIT_FAILURE);</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  }</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno"><a class="line" href="structfst_1_1Scorer.html#a46182502865928c075ac3dec7c7257f6">  154</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structfst_1_1Scorer.html#a46182502865928c075ac3dec7c7257f6">operator()</a>(StateT <span class="keyword">const</span> &amp;current, <span class="keywordtype">float</span> &amp;w, <span class="keywordtype">float</span> &amp;wp, <span class="keywordtype">int</span> ilabel, <span class="keywordtype">int</span> olabel, StateT&amp; next) {</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    w = lmmodel_.Score ( current, idbridge_.map(olabel), next ) * natlog10_();</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    hs_(w, wp, olabel, next); <span class="comment">//hack to make it srilm/nplm compliant</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  }</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;};</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">// partial template specialization class for nplm model</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">// TODO: code reorganization/simplification needed</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="keyword">template</span>&lt; <span class="keyword">class </span>IdBridgeT</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;         , <span class="keyword">template</span>&lt;<span class="keyword">class</span>&gt; <span class="keyword">class </span>HackScoreT</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;         &gt;</div><div class="line"><a name="l00165"></a><span class="lineno"><a class="line" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html">  165</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structfst_1_1Scorer.html">Scorer</a>&lt;<a class="code" href="namespacelm.html">lm</a>::np::State, lm::np::Model</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;              , IdBridgeT, HackScoreT&gt; {</div><div class="line"><a name="l00167"></a><span class="lineno"><a class="line" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#ad2063352c279523edc32efaad4721ea6">  167</a></span>&#160;  IdBridgeT <span class="keyword">const</span>&amp; <a class="code" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#ad2063352c279523edc32efaad4721ea6">idbridge_</a>;</div><div class="line"><a name="l00168"></a><span class="lineno"><a class="line" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#aa01803a6cbae281ab0bd1780a7a3271f">  168</a></span>&#160;  <span class="keyword">typedef</span> lm::np::Model  <a class="code" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#aa01803a6cbae281ab0bd1780a7a3271f">KenLMModelT</a>;</div><div class="line"><a name="l00169"></a><span class="lineno"><a class="line" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#a32cfff35cc56f2df66729aeb52675e71">  169</a></span>&#160;  <span class="keyword">typedef</span> lm::np::State  <a class="code" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#a32cfff35cc56f2df66729aeb52675e71">StateT</a>;</div><div class="line"><a name="l00170"></a><span class="lineno"><a class="line" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#a60c3d4a7985e373513d66296b19ebd06">  170</a></span>&#160;  KenLMModelT &amp; <a class="code" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#a60c3d4a7985e373513d66296b19ebd06">lmmodel_</a>;</div><div class="line"><a name="l00171"></a><span class="lineno"><a class="line" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#a6ede9e8ea0d7cf302a36fe08b5f72575">  171</a></span>&#160;  HackScoreT&lt;StateT&gt; <a class="code" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#a6ede9e8ea0d7cf302a36fe08b5f72575">hs_</a>;</div><div class="line"><a name="l00172"></a><span class="lineno"><a class="line" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#af22183df1299ea597488bdad77147ef4">  172</a></span>&#160;  <a class="code" href="structfst_1_1Scale.html">Scale&lt;StateT&gt;</a> &amp;<a class="code" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#af22183df1299ea597488bdad77147ef4">natlog10_</a>;</div><div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#a58654533046422080b1f26f1c0ef75c5">  173</a></span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#a58654533046422080b1f26f1c0ef75c5">srcSize_</a>;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#a362fa2a45c32f16f64ae399b744378bb">  175</a></span>&#160;  std::vector&lt; std::vector&lt;unsigned&gt; &gt; <a class="code" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#a362fa2a45c32f16f64ae399b744378bb">srcWindows_</a>;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno"><a class="line" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#afd964fed62429370542b0ecc3dfb0bae">  177</a></span>&#160;  <a class="code" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#afd964fed62429370542b0ecc3dfb0bae">Scorer</a>(KenLMModelT &amp;lmmodel</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;         , IdBridgeT <span class="keyword">const</span> &amp;idbridge</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;         , <a class="code" href="structfst_1_1Scale.html">Scale&lt;StateT&gt;</a> &amp;nl</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;         , <span class="keywordtype">unsigned</span> srcSize</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;         , std::vector&lt;std::vector&lt;unsigned&gt; &gt; <span class="keyword">const</span> &amp;srcWindows</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;         )</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      : idbridge_(idbridge)</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      , lmmodel_(lmmodel)</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      , natlog10_(nl)</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      , srcSize_(srcSize)</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  {</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    srcWindows_.clear();</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">// need to map source labels into nplm internal labels.</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    srcWindows_.resize(srcWindows.size());</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> k = 0; k &lt; srcWindows.size(); ++k) {</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      srcWindows_[k].resize(srcWindows[k].size());</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = 0; j &lt; srcWindows[k].size(); ++j) {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        srcWindows_[k][j] = idbridge_.map(srcWindows[k][j]);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    }</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="preprocessor">#ifdef PRINTDEBUG1</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">// For debugging purposes, lets print mapped vectors here:</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> k = 0; k &lt; srcWindows_.size(); ++k) {</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      std::stringstream ss; ss &lt;&lt; srcWindows_[k][0];</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = 1; j &lt; srcWindows_[k].size(); ++j ){</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        ss &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; srcWindows_[k][j];</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      }</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <a class="code" href="logger_8boost__log_8hpp.html#a136d9d772791ddd40a7781b0f6b01dd6">LDEBUG</a>(<span class="stringliteral">&quot;*** MAPPED src words=&quot;</span> &lt;&lt; ss.str());</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  };</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="comment">// For bilingual model</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="comment">// This assumes that ilabels are indices or pointers to the source sentence</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="comment">// olabels are actual target words.</span></div><div class="line"><a name="l00212"></a><span class="lineno"><a class="line" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#a9cbfb3bd2a7616edcf99ddce1db6d8b6">  212</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#a9cbfb3bd2a7616edcf99ddce1db6d8b6">operator()</a>(StateT <span class="keyword">const</span> &amp;current, <span class="keywordtype">float</span> &amp;w, <span class="keywordtype">float</span> &amp;wp, <span class="keywordtype">int</span> ilabel</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                  , <span class="keywordtype">int</span> olabel, StateT&amp; next) {</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">// make a copy of current state and add source window.</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    StateT c2 = current;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <a class="code" href="logger_8boost__log_8hpp.html#a136d9d772791ddd40a7781b0f6b01dd6">LDEBUG</a>(<span class="stringliteral">&quot;Current model state=&quot;</span> &lt;&lt; <a class="code" href="namespacefst.html#af2ba34587e640e012e10b00a65478e72">printDebug</a>(c2));</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="keywordflow">if</span> (srcWindows_.size()) {</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      --ilabel;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      <span class="keywordflow">if</span> (ilabel &gt;= srcWindows_.size() || ilabel &lt; 0) {</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <a class="code" href="logger_8boost__log_8hpp.html#ad364e6e39b7970e4548d99dc3c0c68cc">LERROR</a>(<span class="stringliteral">&quot;Wrong input label! Input labels should be links/affiliations &quot;</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;pointing to words in the source sentence:&quot;</span> &lt;&lt; ilabel);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        exit(EXIT_FAILURE);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      }</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="preprocessor">#ifdef PRINTDEBUG1</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      std::stringstream ss;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; srcSize_; ++k) {</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="preprocessor">#ifdef PRINTDEBUG1</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        ss &lt;&lt; ilabel &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; k &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; srcWindows_[ilabel][k] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span>;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        c2.words[k] = srcWindows_[ilabel][k];</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      }</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      <a class="code" href="logger_8boost__log_8hpp.html#a136d9d772791ddd40a7781b0f6b01dd6">LDEBUG</a>(ss.str() &lt;&lt; <span class="stringliteral">&quot;\nilabel=&quot;</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;             &lt;&lt; ilabel &lt;&lt; <span class="stringliteral">&quot;, Current model state after adding source=&quot;</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;             &lt;&lt; <a class="code" href="namespacefst.html#af2ba34587e640e012e10b00a65478e72">printDebug</a>(c2));</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    }</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordtype">unsigned</span> ol = idbridge_.mapOutput(olabel);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    w = lmmodel_.Score ( c2, ol, next ) * natlog10_();</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <a class="code" href="logger_8boost__log_8hpp.html#a136d9d772791ddd40a7781b0f6b01dd6">LDEBUG</a>(<span class="stringliteral">&quot;Mapped olabel=&quot;</span> &lt;&lt; olabel  &lt;&lt; <span class="stringliteral">&quot; to &quot;</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;           &lt;&lt; ol</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;           &lt;&lt; <span class="stringliteral">&quot;, score=&quot;</span> &lt;&lt; w);</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <a class="code" href="logger_8boost__log_8hpp.html#a136d9d772791ddd40a7781b0f6b01dd6">LDEBUG</a>(<span class="stringliteral">&quot;Next state is (kenlm) =&quot;</span> &lt;&lt; <a class="code" href="namespacefst.html#af2ba34587e640e012e10b00a65478e72">printDebug</a>(next));</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    hs_(w, wp, olabel, next); <span class="comment">//hack to make it srilm/nplm compliant</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <a class="code" href="logger_8boost__log_8hpp.html#a136d9d772791ddd40a7781b0f6b01dd6">LDEBUG</a>(<span class="stringliteral">&quot;Next state is (after hack) =&quot;</span> &lt;&lt; <a class="code" href="namespacefst.html#af2ba34587e640e012e10b00a65478e72">printDebug</a>(next));</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="comment">// finally, update nextstate by taking current state,</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="comment">// adding olabel and sliding the window</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="comment">// (only target model context)</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="comment">// this could go into the hackscore class?</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="comment">// kenlm has shifted the state, but now i take out</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="comment">// the source words in the input</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; srcSize_; ++k) next.words[k] = 0;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordtype">unsigned</span> oli = idbridge_.map(olabel);</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordtype">bool</span> failure = <span class="keyword">false</span>;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordtype">int</span> offset = (int) lmmodel_.Order() - 2;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">if</span> (next.words[offset] != ol) {</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <a class="code" href="logger_8boost__log_8hpp.html#ad364e6e39b7970e4548d99dc3c0c68cc">LERROR</a>(<span class="stringliteral">&quot;Problem:&quot;</span> &lt;&lt; offset &lt;&lt; <span class="stringliteral">&quot;=&gt;&quot;</span> &lt;&lt; next.words[offset]);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      failure = <span class="keyword">true</span>;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    }</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="comment">// ... and map the last word with the input vocabulary (instead of output)</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="comment">// input and output vocabularies are not necessarily the same</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">// and this is particularly true in a bilingual model!</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    next.words[offset] = oli;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <a class="code" href="logger_8boost__log_8hpp.html#a136d9d772791ddd40a7781b0f6b01dd6">LDEBUG</a>(<span class="stringliteral">&quot;*** &quot;</span> &lt;&lt; <a class="code" href="namespacefst.html#af2ba34587e640e012e10b00a65478e72">printDebug</a>(c2)</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;           &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; <a class="code" href="namespacefst.html#af2ba34587e640e012e10b00a65478e72">printDebug</a>(revertMappings(c2))</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;           &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; w &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; <a class="code" href="namespacefst.html#af2ba34587e640e012e10b00a65478e72">printDebug</a>(next)</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;           &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; <a class="code" href="namespacefst.html#af2ba34587e640e012e10b00a65478e72">printDebug</a>(revertMappings(next))</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;           &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; olabel &lt;&lt; <span class="stringliteral">&quot;\t i=&quot;</span> &lt;&lt; oli &lt;&lt; <span class="stringliteral">&quot;, o=&quot;</span> &lt;&lt; ol</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;           );</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">if</span> (failure) exit(EXIT_FAILURE);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  }</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno"><a class="line" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#a17bf814d352896a6aff582731377d474">  275</a></span>&#160;  StateT <a class="code" href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#a17bf814d352896a6aff582731377d474">revertMappings</a>(StateT <span class="keyword">const</span> &amp;s) {</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    StateT x;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; NPLM_MAX_ORDER; ++k) {</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      x.words[k] = idbridge_.rmap(s.words[k]);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    }</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordflow">return</span> x;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  }</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;};</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> ArcT&gt;</div><div class="line"><a name="l00290"></a><span class="lineno"><a class="line" href="structfst_1_1ApplyLanguageModelOnTheFlyInterface.html">  290</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structfst_1_1ApplyLanguageModelOnTheFlyInterface.html">ApplyLanguageModelOnTheFlyInterface</a> {</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keyword">virtual</span> VectorFst&lt;ArcT&gt; *<a class="code" href="countstrings_8main_8cpp.html#a8a1dda39bc667a5a75d4be44f9b24403">run</a>(VectorFst&lt;ArcT&gt; <span class="keyword">const</span>&amp; <a class="code" href="namespacefst.html">fst</a>) = 0;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keyword">virtual</span> VectorFst&lt;ArcT&gt; *<a class="code" href="countstrings_8main_8cpp.html#a8a1dda39bc667a5a75d4be44f9b24403">run</a>(VectorFst&lt;ArcT&gt; <span class="keyword">const</span>&amp; fst</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                               , unordered_set&lt;typename ArcT::Label&gt; <span class="keyword">const</span> &amp;epsilons) = 0;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="keyword">virtual</span> VectorFst&lt;ArcT&gt; *<a class="code" href="countstrings_8main_8cpp.html#a8a1dda39bc667a5a75d4be44f9b24403">run</a>(<span class="keyword">const</span> VectorFst&lt;ArcT&gt;&amp; fst</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                               , <span class="keywordtype">unsigned</span> srcSize</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                               , std::vector&lt; std::vector&lt;unsigned&gt; &gt;  &amp;srcWindows) =0;</div><div class="line"><a name="l00297"></a><span class="lineno"><a class="line" href="structfst_1_1ApplyLanguageModelOnTheFlyInterface.html#a838eac22ecb4301d2841924343e3399a">  297</a></span>&#160;  <span class="keyword">virtual</span> <a class="code" href="structfst_1_1ApplyLanguageModelOnTheFlyInterface.html#a838eac22ecb4301d2841924343e3399a">~ApplyLanguageModelOnTheFlyInterface</a>(){}</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;};</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class </span>Arc</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;          , <span class="keyword">class </span>MakeWeightT = <a class="code" href="structfst_1_1MakeWeight.html">MakeWeight&lt;Arc&gt;</a></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;          , <span class="keyword">class </span>KenLMModelT = lm::ngram::Model</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;          , <span class="keyword">class </span>IdBridgeT = <a class="code" href="classucam_1_1fsttools_1_1IdBridge.html">ucam::fsttools::IdBridge</a></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;          , <span class="keyword">template</span>&lt;<span class="keyword">class</span>&gt; <span class="keyword">class </span>HackScoreT = <a class="code" href="structfst_1_1HackScore.html">HackScore</a> &gt;</div><div class="line"><a name="l00312"></a><span class="lineno"><a class="line" href="classfst_1_1ApplyLanguageModelOnTheFly.html">  312</a></span>&#160;<span class="keyword">class </span><a class="code" href="classfst_1_1ApplyLanguageModelOnTheFly.html">ApplyLanguageModelOnTheFly</a> : <span class="keyword">public</span> <a class="code" href="structfst_1_1ApplyLanguageModelOnTheFlyInterface.html">ApplyLanguageModelOnTheFlyInterface</a>&lt;Arc&gt; {</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keyword">typedef</span> <span class="keyword">typename</span> Arc::StateId StateId;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="keyword">typedef</span> <span class="keyword">typename</span> Arc::Label Label;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="keyword">typedef</span> <span class="keyword">typename</span> Arc::Weight Weight;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> ull;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  unordered_map&lt; ull, StateId &gt; stateexistence_;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> ull sid = 1000000000;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  unordered_map&lt;uint64_t</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                , pair&lt;StateId, typename KenLMModelT::State &gt; &gt; statemap_;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  unordered_map&lt;basic_string&lt;unsigned&gt;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                , StateId</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                , <a class="code" href="namespaceucam_1_1util.html#a0998857de4c50a6e292bdf372be2703f">ucam::util::hashfvecuint</a></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                , <a class="code" href="classucam_1_1util_1_1HashEqVec.html">ucam::util::hasheqvecuint</a>&gt; seenlmstates_;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  queue&lt;StateId&gt; qc_;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  unordered_set&lt;Label&gt; epsilons_;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  KenLMModelT&amp; lmmodel_;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keyword">const</span> <span class="keyword">typename</span> KenLMModelT::Vocabulary&amp; vocab_;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="comment">//  float  natlog10_;</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <a class="code" href="structfst_1_1Scale.html">Scale&lt;typename KenLMModelT::State&gt;</a> natlog10_;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  MakeWeightT mw_;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  basic_string&lt;unsigned&gt; history;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="keywordtype">unsigned</span> *buffer;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keywordtype">unsigned</span> buffersize;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="comment">//Word Penalty.</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keywordtype">float</span> wp_;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="keyword">const</span> IdBridgeT&amp; idbridge_;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="comment">// transparent state handling (kenlm vs nplm)</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <a class="code" href="structfst_1_1StateHandler.html">StateHandler&lt;typename KenLMModelT::State&gt;</a> sh_;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="comment">// transparent score quirks handling for srilm/nplm compliance</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  HackScoreT&lt;typename KenLMModelT::State&gt; hs_;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00365"></a><span class="lineno"><a class="line" href="classfst_1_1ApplyLanguageModelOnTheFly.html#a21bf663d65bd2a0f5feaf6715fdde651">  365</a></span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classfst_1_1ApplyLanguageModelOnTheFly.html#a21bf663d65bd2a0f5feaf6715fdde651">setMakeWeight</a> ( <span class="keyword">const</span> MakeWeightT&amp; mw ) {</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    mw_ = mw;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  };</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00379"></a><span class="lineno"><a class="line" href="classfst_1_1ApplyLanguageModelOnTheFly.html#a302d81b00791377cf5dd568473e84d8e">  379</a></span>&#160;  <a class="code" href="classfst_1_1ApplyLanguageModelOnTheFly.html#a302d81b00791377cf5dd568473e84d8e">ApplyLanguageModelOnTheFly</a> ( KenLMModelT&amp; model</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                               , unordered_set&lt;Label&gt;&amp; epsilons</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                               , <span class="keywordtype">bool</span> natlog</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                               , <span class="keywordtype">float</span> lmscale</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                               , <span class="keywordtype">float</span> lmwp</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                               , <span class="keyword">const</span> IdBridgeT&amp; idbridge</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                               , MakeWeightT &amp;mw</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                               )</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    : natlog10_ ( natlog ? -lmscale* ::log ( 10.0 ) : -lmscale )</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    , lmmodel_ ( model )</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    , vocab_ ( model.GetVocabulary() )</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    , wp_ ( lmwp )</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    , epsilons_ ( epsilons )</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    , history ( model.Order(), 0)</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    , idbridge_ (idbridge)</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    , mw_(mw)</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  {</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    init();</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  };</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno"><a class="line" href="classfst_1_1ApplyLanguageModelOnTheFly.html#a216e67b23eb30862ac574f42fbcdd7fc">  399</a></span>&#160;  <a class="code" href="classfst_1_1ApplyLanguageModelOnTheFly.html#a216e67b23eb30862ac574f42fbcdd7fc">ApplyLanguageModelOnTheFly</a> ( KenLMModelT&amp; model</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                               , <span class="keywordtype">bool</span> natlog</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                               , <span class="keywordtype">float</span> lmscale</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                               , <span class="keywordtype">float</span> lmwp</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                               , <span class="keyword">const</span> IdBridgeT&amp; idbridge</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                               , MakeWeightT &amp;mw</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                               )</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    : natlog10_ ( natlog ? -lmscale* ::log ( 10.0 ) : -lmscale )</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    , lmmodel_ ( model )</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    , vocab_ ( model.GetVocabulary() )</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    , wp_ ( lmwp )</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    , history ( model.Order(), 0)</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    , idbridge_ (idbridge)</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    , mw_(mw)</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  {</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    init();</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  };</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div><div class="line"><a name="l00417"></a><span class="lineno"><a class="line" href="classfst_1_1ApplyLanguageModelOnTheFly.html#aa4ac64184c1f1c8cb1d450b236ea4ec7">  417</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classfst_1_1ApplyLanguageModelOnTheFly.html#aa4ac64184c1f1c8cb1d450b236ea4ec7">init</a>() {</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <a class="code" href="logger_8boost__log_8hpp.html#a136d9d772791ddd40a7781b0f6b01dd6">LDEBUG</a>(<span class="stringliteral">&quot;Model order=&quot;</span> &lt;&lt; (<span class="keywordtype">int</span>) lmmodel_.Order());</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    sh_.<a class="code" href="structfst_1_1StateHandler.html#acc607cb2f842e4ec200dcfc2f254438b">setLength</a>(lmmodel_.Order() );</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    buffersize = (lmmodel_.Order() - 1 ) * <span class="keyword">sizeof</span> (<span class="keywordtype">unsigned</span>);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    buffer = <span class="keyword">const_cast&lt;</span><span class="keywordtype">unsigned</span> *<span class="keyword">&gt;</span> ( history.c_str() );</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  }</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno"><a class="line" href="classfst_1_1ApplyLanguageModelOnTheFly.html#a444263cc6fc5cc6ab55e54cfc829505d">  425</a></span>&#160;  <a class="code" href="classfst_1_1ApplyLanguageModelOnTheFly.html#a444263cc6fc5cc6ab55e54cfc829505d">~ApplyLanguageModelOnTheFly</a>() {};</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno"><a class="line" href="classfst_1_1ApplyLanguageModelOnTheFly.html#a55647f5f94e96b628955379977e1831b">  427</a></span>&#160;  VectorFst&lt;Arc&gt; *<a class="code" href="classfst_1_1ApplyLanguageModelOnTheFly.html#a55647f5f94e96b628955379977e1831b">run</a>(<span class="keyword">const</span> VectorFst&lt;Arc&gt;&amp; <a class="code" href="namespacefst.html">fst</a>) {</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">return</span> this-&gt;operator()(fst);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  }</div><div class="line"><a name="l00430"></a><span class="lineno"><a class="line" href="classfst_1_1ApplyLanguageModelOnTheFly.html#a34ec16b4f30e6bb6e9a10e1b59a7e431">  430</a></span>&#160;  VectorFst&lt;Arc&gt; *<a class="code" href="classfst_1_1ApplyLanguageModelOnTheFly.html#a34ec16b4f30e6bb6e9a10e1b59a7e431">run</a>(<span class="keyword">const</span> VectorFst&lt;Arc&gt;&amp; <a class="code" href="namespacefst.html">fst</a></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                      , unordered_set&lt;Label&gt; <span class="keyword">const</span> &amp;epsilons) {</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    epsilons_ = epsilons;    <span class="comment">// this may be necessary e.g. for pdts</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordflow">return</span> this-&gt;<a class="code" href="countstrings_8main_8cpp.html#a8a1dda39bc667a5a75d4be44f9b24403">run</a>(fst);</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  }</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno"><a class="line" href="classfst_1_1ApplyLanguageModelOnTheFly.html#a461a73bd14cb5915d9bc3befa8b3f57e">  436</a></span>&#160;  VectorFst&lt;Arc&gt; *<a class="code" href="classfst_1_1ApplyLanguageModelOnTheFly.html#a461a73bd14cb5915d9bc3befa8b3f57e">run</a>(<span class="keyword">const</span> VectorFst&lt;Arc&gt;&amp; <a class="code" href="namespacefst.html">fst</a></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                      , <span class="keywordtype">unsigned</span> size</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                      , std::vector&lt;std::vector&lt;unsigned&gt; &gt; &amp;srcWindows) {</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="comment">//    epsilons_ = epsilons;    // this may be necessary e.g. for pdts</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordflow">return</span> this-&gt;operator()(fst,size, srcWindows);</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  };</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno"><a class="line" href="classfst_1_1ApplyLanguageModelOnTheFly.html#a3275a673d759ee2cd8c934144239b4c1">  445</a></span>&#160;  VectorFst&lt;Arc&gt; * operator() (<span class="keyword">const</span> VectorFst&lt;Arc&gt;&amp; <a class="code" href="namespacefst.html">fst</a>) {</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordtype">unsigned</span> ign = 0;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    std::vector&lt;std::vector&lt;unsigned&gt; &gt; empty;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <a class="code" href="structfst_1_1Scorer.html">Scorer&lt;typename KenLMModelT::State, KenLMModelT, IdBridgeT, HackScoreT&gt;</a></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      sc(lmmodel_, idbridge_, natlog10_, ign, empty );</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">return</span> doComposition(fst, sc);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  }</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="comment">// Composition with bilm</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="comment">// note that input labels are indices to source windows</span></div><div class="line"><a name="l00455"></a><span class="lineno"><a class="line" href="classfst_1_1ApplyLanguageModelOnTheFly.html#ab943d231765c8d8676bca67353a5b465">  455</a></span>&#160;  VectorFst&lt;Arc&gt; * operator() (<span class="keyword">const</span> VectorFst&lt;Arc&gt;&amp; <a class="code" href="namespacefst.html">fst</a>, <span class="keywordtype">unsigned</span> srcSize</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                               , std::vector&lt;std::vector&lt;unsigned&gt; &gt; &amp;srcw) {</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="comment">// the scorer will help compute the correct score regardless of whether it is a</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="comment">// bilingual model or not, etc.</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <a class="code" href="structfst_1_1Scorer.html">Scorer&lt;typename KenLMModelT::State, KenLMModelT, IdBridgeT, HackScoreT&gt;</a></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      sc(lmmodel_, idbridge_, natlog10_ , srcSize, srcw);</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordflow">return</span> doComposition(fst, sc);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  }</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  VectorFst&lt;Arc&gt; * doComposition(<span class="keyword">const</span> VectorFst&lt;Arc&gt;&amp; <a class="code" href="namespacefst.html">fst</a></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                                 , <a class="code" href="structfst_1_1Scorer.html">Scorer&lt;typename KenLMModelT::State, KenLMModelT, IdBridgeT, HackScoreT&gt;</a> &amp;sc) {</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">if</span> (!fst.NumStates() ) {</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      <a class="code" href="logger_8boost__log_8hpp.html#a6ffaab1d2d66f7f82bb45ce32e7e48e4">LWARN</a> (<span class="stringliteral">&quot;Empty lattice. ... Skipping LM application!&quot;</span>);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    }</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    VectorFst&lt;Arc&gt; *composed = <span class="keyword">new</span> VectorFst&lt;Arc&gt;;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keyword">typename</span> KenLMModelT::State bs = lmmodel_.NullContextState();</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    pair&lt;StateId, bool&gt; nextp = add ( composed, bs, fst.Start(), fst.Final ( fst.Start() ) );</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    qc_.push ( nextp.first );</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    composed-&gt;SetStart ( nextp.first );</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keywordflow">while</span> ( qc_.size() ) {</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      <a class="code" href="logger_8boost__log_8hpp.html#a136d9d772791ddd40a7781b0f6b01dd6">LDEBUG</a>(<span class="stringliteral">&quot;queue size=&quot;</span> &lt;&lt; qc_.size());</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      StateId s = qc_.front();</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      qc_.pop();</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      pair&lt;StateId, const typename KenLMModelT::State&gt; p = <span class="keyword">get</span> ( s );</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      StateId&amp; s1 = p.first;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="keyword">const</span> <span class="keyword">typename</span> KenLMModelT::State s2 = p.second;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      <span class="keywordflow">for</span> ( ArcIterator&lt; VectorFst&lt;Arc&gt; &gt; arc1 ( fst, s1 ); !arc1.Done();</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;            arc1.Next() ) {</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <span class="keyword">const</span> Arc&amp; a1 = arc1.Value();</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="keywordtype">float</span> w = 0;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="keywordtype">float</span> wp = wp_;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="keyword">typename</span> KenLMModelT::State nextlmstate;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <span class="keywordflow">if</span> ( epsilons_.find ( a1.olabel ) == epsilons_.end() ) {</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;          sc(s2, w, wp, a1.ilabel, a1.olabel, nextlmstate);</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;          <span class="comment">// ignore epsilons completely, even if we have alignments here.</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;          nextlmstate = s2;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;          wp = 0; <span class="comment">//We don&#39;t count epsilon labels</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;         }</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        pair&lt;StateId, bool&gt; nextp = add ( composed, nextlmstate</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                                          , a1.nextstate</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                                          , fst.Final ( a1.nextstate ) );</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        StateId&amp; newstate = nextp.first;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="keywordtype">bool</span> visited = nextp.second;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        composed-&gt;AddArc ( s, Arc( a1.ilabel, a1.olabel</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                                   , <a class="code" href="namespacefst.html#a078df45c8364cd74acdb682726a75151">Times</a> ( a1.weight, <a class="code" href="namespacefst.html#a078df45c8364cd74acdb682726a75151">Times</a> (mw_ ( w ) , mw_ (wp) ) )</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                                   , newstate ) );</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="comment">//Finally, only add newstate to the queue if it hasn&#39;t been visited previously</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="keywordflow">if</span> ( !visited ) {</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;          qc_.push ( newstate );</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        }</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      }</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    }</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <a class="code" href="logger_8boost__log_8hpp.html#adf127ca2262cc160830da49c37d04e85">LINFO</a> ( <span class="stringliteral">&quot;Done! Number of states=&quot;</span> &lt;&lt; composed-&gt;NumStates() );</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    stateexistence_.clear();</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    statemap_.clear();</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    seenlmstates_.clear();</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    history.resize( lmmodel_.Order(), 0);</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordflow">return</span> composed;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  };</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="keyword">inline</span> pair &lt;StateId, bool&gt; add ( fst::VectorFst&lt;Arc&gt; *composed, <span class="keyword">typename</span> KenLMModelT::State&amp; m2nextstate,</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                                    StateId m1nextstate, Weight m1stateweight ) {</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keyword">static</span> StateId <a class="code" href="namespacelm.html">lm</a> = 0;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    getIdx ( m2nextstate );</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordflow">if</span> ( seenlmstates_.find ( history ) == seenlmstates_.end() ) {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      seenlmstates_[history] = ++lm;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    }</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    uint64_t compound = m1nextstate * sid + seenlmstates_[history];</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <a class="code" href="logger_8boost__log_8hpp.html#a136d9d772791ddd40a7781b0f6b01dd6">LDEBUG</a> ( <span class="stringliteral">&quot;compound id=&quot;</span> &lt;&lt; compound );</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keywordflow">if</span> ( stateexistence_.find ( compound ) == stateexistence_.end() ) {</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      <a class="code" href="logger_8boost__log_8hpp.html#a136d9d772791ddd40a7781b0f6b01dd6">LDEBUG</a> ( <span class="stringliteral">&quot;New State!&quot;</span> );</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      statemap_[composed-&gt;NumStates()] =</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        pair&lt;StateId, const typename KenLMModelT::State &gt; ( m1nextstate, m2nextstate );</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      composed-&gt;AddState();</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      <a class="code" href="logger_8boost__log_8hpp.html#a136d9d772791ddd40a7781b0f6b01dd6">LDEBUG</a>(<span class="stringliteral">&quot;Added...&quot;</span> &lt;&lt; composed-&gt;NumStates() &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; m1nextstate &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; <a class="code" href="namespacefst.html#af2ba34587e640e012e10b00a65478e72">printDebug</a>(m2nextstate));</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keywordflow">if</span> ( m1stateweight != mw_ ( <a class="code" href="namespacefst.html#a44ae4725c7f99b13ab8e3ec44ee60e33">ZPosInfinity</a>() ) ) composed-&gt;SetFinal (</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;          composed-&gt;NumStates() - 1, m1stateweight );</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      stateexistence_[compound] = composed-&gt;NumStates() - 1;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      <span class="keywordflow">return</span> pair&lt;StateId, bool&gt; ( composed-&gt;NumStates() - 1, false );</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    }</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">return</span> pair&lt;StateId, bool&gt; ( stateexistence_[compound], true );</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  };</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> getIdx ( <span class="keyword">const</span> <span class="keyword">typename</span> KenLMModelT::State&amp; state,</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                       uint order = 4 ) {</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <a class="code" href="logger_8boost__log_8hpp.html#a136d9d772791ddd40a7781b0f6b01dd6">LDEBUG</a>(<span class="stringliteral">&quot;getting Idx&quot;</span>);</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    memcpy ( buffer, state.words, buffersize );</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="comment">//    for ( uint k = state.length; k &lt; history.size(); ++k ) history[k] = 0;</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> k = sh_.<a class="code" href="structfst_1_1StateHandler.html#a55e8e7017eb6a369918c480012f37864">getLength</a>(state); k &lt; history.size(); ++k ) history[k] = 0;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  };</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <span class="keyword">inline</span> pair&lt;StateId, typename KenLMModelT::State &gt; <span class="keyword">get</span> ( StateId state ) {</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <a class="code" href="logger_8boost__log_8hpp.html#a136d9d772791ddd40a7781b0f6b01dd6">LDEBUG</a>(<span class="stringliteral">&quot;get&quot;</span>);</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordflow">return</span> statemap_[state];</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  };</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;};</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;} <span class="comment">// end namespaces</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div><div class="ttc" id="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4_html_aa01803a6cbae281ab0bd1780a7a3271f"><div class="ttname"><a href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#aa01803a6cbae281ab0bd1780a7a3271f">fst::Scorer&lt; lm::np::State, lm::np::Model, IdBridgeT, HackScoreT &gt;::KenLMModelT</a></div><div class="ttdeci">lm::np::Model KenLMModelT</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00168">fstutils.applylmonthefly.hpp:168</a></div></div>
<div class="ttc" id="structfst_1_1Scorer_html_aaea694bba2a0d629986c9732b5f3ee33"><div class="ttname"><a href="structfst_1_1Scorer.html#aaea694bba2a0d629986c9732b5f3ee33">fst::Scorer::Scorer</a></div><div class="ttdeci">Scorer(KenLMModelT &amp;lmmodel, IdBridgeT const &amp;idbridge, Scale&lt; StateT &gt; &amp;nl, unsigned, std::vector&lt; std::vector&lt; unsigned &gt; &gt; const &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00140">fstutils.applylmonthefly.hpp:140</a></div></div>
<div class="ttc" id="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4_html_afd964fed62429370542b0ecc3dfb0bae"><div class="ttname"><a href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#afd964fed62429370542b0ecc3dfb0bae">fst::Scorer&lt; lm::np::State, lm::np::Model, IdBridgeT, HackScoreT &gt;::Scorer</a></div><div class="ttdeci">Scorer(KenLMModelT &amp;lmmodel, IdBridgeT const &amp;idbridge, Scale&lt; StateT &gt; &amp;nl, unsigned srcSize, std::vector&lt; std::vector&lt; unsigned &gt; &gt; const &amp;srcWindows)</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00177">fstutils.applylmonthefly.hpp:177</a></div></div>
<div class="ttc" id="countstrings_8main_8cpp_html_a8a1dda39bc667a5a75d4be44f9b24403"><div class="ttname"><a href="countstrings_8main_8cpp.html#a8a1dda39bc667a5a75d4be44f9b24403">run</a></div><div class="ttdeci">void run(ucam::util::RegistryPO const &amp;rg)</div><div class="ttdef"><b>Definition:</b> <a href="countstrings_8main_8cpp_source.html#l00047">countstrings.main.cpp:47</a></div></div>
<div class="ttc" id="structfst_1_1Scale_html_a3a0f73e16c82bcc515ad9a90e4791e85"><div class="ttname"><a href="structfst_1_1Scale.html#a3a0f73e16c82bcc515ad9a90e4791e85">fst::Scale::scale_</a></div><div class="ttdeci">float scale_</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00046">fstutils.applylmonthefly.hpp:46</a></div></div>
<div class="ttc" id="structfst_1_1Scale_html"><div class="ttname"><a href="structfst_1_1Scale.html">fst::Scale</a></div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00045">fstutils.applylmonthefly.hpp:45</a></div></div>
<div class="ttc" id="classfst_1_1ApplyLanguageModelOnTheFly_html_a444263cc6fc5cc6ab55e54cfc829505d"><div class="ttname"><a href="classfst_1_1ApplyLanguageModelOnTheFly.html#a444263cc6fc5cc6ab55e54cfc829505d">fst::ApplyLanguageModelOnTheFly::~ApplyLanguageModelOnTheFly</a></div><div class="ttdeci">~ApplyLanguageModelOnTheFly()</div><div class="ttdoc">Destructor. </div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00425">fstutils.applylmonthefly.hpp:425</a></div></div>
<div class="ttc" id="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4_html_a9cbfb3bd2a7616edcf99ddce1db6d8b6"><div class="ttname"><a href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#a9cbfb3bd2a7616edcf99ddce1db6d8b6">fst::Scorer&lt; lm::np::State, lm::np::Model, IdBridgeT, HackScoreT &gt;::operator()</a></div><div class="ttdeci">void operator()(StateT const &amp;current, float &amp;w, float &amp;wp, int ilabel, int olabel, StateT &amp;next)</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00212">fstutils.applylmonthefly.hpp:212</a></div></div>
<div class="ttc" id="classfst_1_1ApplyLanguageModelOnTheFly_html_a461a73bd14cb5915d9bc3befa8b3f57e"><div class="ttname"><a href="classfst_1_1ApplyLanguageModelOnTheFly.html#a461a73bd14cb5915d9bc3befa8b3f57e">fst::ApplyLanguageModelOnTheFly::run</a></div><div class="ttdeci">VectorFst&lt; Arc &gt; * run(const VectorFst&lt; Arc &gt; &amp;fst, unsigned size, std::vector&lt; std::vector&lt; unsigned &gt; &gt; &amp;srcWindows)</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00436">fstutils.applylmonthefly.hpp:436</a></div></div>
<div class="ttc" id="structfst_1_1StateHandler_html"><div class="ttname"><a href="structfst_1_1StateHandler.html">fst::StateHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00031">fstutils.applylmonthefly.hpp:31</a></div></div>
<div class="ttc" id="structfst_1_1StateHandler_html_a55e8e7017eb6a369918c480012f37864"><div class="ttname"><a href="structfst_1_1StateHandler.html#a55e8e7017eb6a369918c480012f37864">fst::StateHandler::getLength</a></div><div class="ttdeci">unsigned getLength(StateT const &amp;state)</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00033">fstutils.applylmonthefly.hpp:33</a></div></div>
<div class="ttc" id="logger_8boost__log_8hpp_html_adf127ca2262cc160830da49c37d04e85"><div class="ttname"><a href="logger_8boost__log_8hpp.html#adf127ca2262cc160830da49c37d04e85">LINFO</a></div><div class="ttdeci">#define LINFO(msg)</div><div class="ttdef"><b>Definition:</b> <a href="logger_8boost__log_8hpp_source.html#l00078">logger.boost_log.hpp:78</a></div></div>
<div class="ttc" id="namespacefst_html"><div class="ttname"><a href="namespacefst.html">fst</a></div><div class="ttdef"><b>Definition:</b> <a href="fstio_8hpp_source.html#l00027">fstio.hpp:27</a></div></div>
<div class="ttc" id="structfst_1_1Scale_html_a607cd6ae3dc803c19edd38100d3fdf2c"><div class="ttname"><a href="structfst_1_1Scale.html#a607cd6ae3dc803c19edd38100d3fdf2c">fst::Scale::Scale</a></div><div class="ttdeci">Scale(float scale)</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00047">fstutils.applylmonthefly.hpp:47</a></div></div>
<div class="ttc" id="structfst_1_1Scorer_html_ab626e61699d8ee8e5be62da78aba81cf"><div class="ttname"><a href="structfst_1_1Scorer.html#ab626e61699d8ee8e5be62da78aba81cf">fst::Scorer::lmmodel_</a></div><div class="ttdeci">KenLMModelT &amp; lmmodel_</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00137">fstutils.applylmonthefly.hpp:137</a></div></div>
<div class="ttc" id="classfst_1_1ApplyLanguageModelOnTheFly_html_a302d81b00791377cf5dd568473e84d8e"><div class="ttname"><a href="classfst_1_1ApplyLanguageModelOnTheFly.html#a302d81b00791377cf5dd568473e84d8e">fst::ApplyLanguageModelOnTheFly::ApplyLanguageModelOnTheFly</a></div><div class="ttdeci">ApplyLanguageModelOnTheFly(KenLMModelT &amp;model, unordered_set&lt; Label &gt; &amp;epsilons, bool natlog, float lmscale, float lmwp, const IdBridgeT &amp;idbridge, MakeWeightT &amp;mw)</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00379">fstutils.applylmonthefly.hpp:379</a></div></div>
<div class="ttc" id="structfst_1_1StateHandler_3_01lm_1_1np_1_1State_01_4_html_aa441eeb89c4b2e8d2f44b11420ab238d"><div class="ttname"><a href="structfst_1_1StateHandler_3_01lm_1_1np_1_1State_01_4.html#aa441eeb89c4b2e8d2f44b11420ab238d">fst::StateHandler&lt; lm::np::State &gt;::setLength</a></div><div class="ttdeci">void setLength(unsigned length)</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00040">fstutils.applylmonthefly.hpp:40</a></div></div>
<div class="ttc" id="logger_8boost__log_8hpp_html_a136d9d772791ddd40a7781b0f6b01dd6"><div class="ttname"><a href="logger_8boost__log_8hpp.html#a136d9d772791ddd40a7781b0f6b01dd6">LDEBUG</a></div><div class="ttdeci">#define LDEBUG(msg)</div><div class="ttdef"><b>Definition:</b> <a href="logger_8boost__log_8hpp_source.html#l00107">logger.boost_log.hpp:107</a></div></div>
<div class="ttc" id="classfst_1_1ApplyLanguageModelOnTheFly_html_a216e67b23eb30862ac574f42fbcdd7fc"><div class="ttname"><a href="classfst_1_1ApplyLanguageModelOnTheFly.html#a216e67b23eb30862ac574f42fbcdd7fc">fst::ApplyLanguageModelOnTheFly::ApplyLanguageModelOnTheFly</a></div><div class="ttdeci">ApplyLanguageModelOnTheFly(KenLMModelT &amp;model, bool natlog, float lmscale, float lmwp, const IdBridgeT &amp;idbridge, MakeWeightT &amp;mw)</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00399">fstutils.applylmonthefly.hpp:399</a></div></div>
<div class="ttc" id="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4_html_a17bf814d352896a6aff582731377d474"><div class="ttname"><a href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#a17bf814d352896a6aff582731377d474">fst::Scorer&lt; lm::np::State, lm::np::Model, IdBridgeT, HackScoreT &gt;::revertMappings</a></div><div class="ttdeci">StateT revertMappings(StateT const &amp;s)</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00275">fstutils.applylmonthefly.hpp:275</a></div></div>
<div class="ttc" id="structfst_1_1HackScore_3_01lm_1_1np_1_1State_01_4_html_a1fb33f5d91af57ac7065511bac715602"><div class="ttname"><a href="structfst_1_1HackScore_3_01lm_1_1np_1_1State_01_4.html#a1fb33f5d91af57ac7065511bac715602">fst::HackScore&lt; lm::np::State &gt;::operator()</a></div><div class="ttdeci">void operator()(float &amp;w, float &amp;wp, unsigned label, lm::np::State &amp;ns)</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00083">fstutils.applylmonthefly.hpp:83</a></div></div>
<div class="ttc" id="classfst_1_1ApplyLanguageModelOnTheFly_html_a21bf663d65bd2a0f5feaf6715fdde651"><div class="ttname"><a href="classfst_1_1ApplyLanguageModelOnTheFly.html#a21bf663d65bd2a0f5feaf6715fdde651">fst::ApplyLanguageModelOnTheFly::setMakeWeight</a></div><div class="ttdeci">void setMakeWeight(const MakeWeightT &amp;mw)</div><div class="ttdoc">Public methods. </div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00365">fstutils.applylmonthefly.hpp:365</a></div></div>
<div class="ttc" id="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4_html_af22183df1299ea597488bdad77147ef4"><div class="ttname"><a href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#af22183df1299ea597488bdad77147ef4">fst::Scorer&lt; lm::np::State, lm::np::Model, IdBridgeT, HackScoreT &gt;::natlog10_</a></div><div class="ttdeci">Scale&lt; StateT &gt; &amp; natlog10_</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00172">fstutils.applylmonthefly.hpp:172</a></div></div>
<div class="ttc" id="structfst_1_1Scale_3_01lm_1_1np_1_1State_01_4_html_a52df0fe823f963bdc7180fe76cb4d43e"><div class="ttname"><a href="structfst_1_1Scale_3_01lm_1_1np_1_1State_01_4.html#a52df0fe823f963bdc7180fe76cb4d43e">fst::Scale&lt; lm::np::State &gt;::Scale</a></div><div class="ttdeci">Scale(float scale)</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00058">fstutils.applylmonthefly.hpp:58</a></div></div>
<div class="ttc" id="classucam_1_1fsttools_1_1IdBridge_html"><div class="ttname"><a href="classucam_1_1fsttools_1_1IdBridge.html">ucam::fsttools::IdBridge</a></div><div class="ttdef"><b>Definition:</b> <a href="idbridge_8hpp_source.html#l00031">idbridge.hpp:31</a></div></div>
<div class="ttc" id="structfst_1_1Scorer_html_a46182502865928c075ac3dec7c7257f6"><div class="ttname"><a href="structfst_1_1Scorer.html#a46182502865928c075ac3dec7c7257f6">fst::Scorer::operator()</a></div><div class="ttdeci">void operator()(StateT const &amp;current, float &amp;w, float &amp;wp, int ilabel, int olabel, StateT &amp;next)</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00154">fstutils.applylmonthefly.hpp:154</a></div></div>
<div class="ttc" id="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4_html_ad2063352c279523edc32efaad4721ea6"><div class="ttname"><a href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#ad2063352c279523edc32efaad4721ea6">fst::Scorer&lt; lm::np::State, lm::np::Model, IdBridgeT, HackScoreT &gt;::idbridge_</a></div><div class="ttdeci">IdBridgeT const &amp; idbridge_</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00167">fstutils.applylmonthefly.hpp:167</a></div></div>
<div class="ttc" id="structfst_1_1HackScore_html"><div class="ttname"><a href="structfst_1_1HackScore.html">fst::HackScore</a></div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00070">fstutils.applylmonthefly.hpp:70</a></div></div>
<div class="ttc" id="structfst_1_1StateHandler_3_01lm_1_1np_1_1State_01_4_html_adf6be20bd5601b30a8143019169047e6"><div class="ttname"><a href="structfst_1_1StateHandler_3_01lm_1_1np_1_1State_01_4.html#adf6be20bd5601b30a8143019169047e6">fst::StateHandler&lt; lm::np::State &gt;::getLength</a></div><div class="ttdeci">unsigned getLength(lm::np::State const &amp;state) const </div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00041">fstutils.applylmonthefly.hpp:41</a></div></div>
<div class="ttc" id="structfst_1_1Scale_3_01lm_1_1np_1_1State_01_4_html_ae6c4c017b1a7542b13018363fb9ead97"><div class="ttname"><a href="structfst_1_1Scale_3_01lm_1_1np_1_1State_01_4.html#ae6c4c017b1a7542b13018363fb9ead97">fst::Scale&lt; lm::np::State &gt;::scale_</a></div><div class="ttdeci">float scale_</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00057">fstutils.applylmonthefly.hpp:57</a></div></div>
<div class="ttc" id="classfst_1_1ApplyLanguageModelOnTheFly_html_aa4ac64184c1f1c8cb1d450b236ea4ec7"><div class="ttname"><a href="classfst_1_1ApplyLanguageModelOnTheFly.html#aa4ac64184c1f1c8cb1d450b236ea4ec7">fst::ApplyLanguageModelOnTheFly::init</a></div><div class="ttdeci">void init()</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00417">fstutils.applylmonthefly.hpp:417</a></div></div>
<div class="ttc" id="structfst_1_1Scorer_html_aa49f822e546e1a003c7b6d30e68f709c"><div class="ttname"><a href="structfst_1_1Scorer.html#aa49f822e546e1a003c7b6d30e68f709c">fst::Scorer::natlog10_</a></div><div class="ttdeci">Scale&lt; StateT &gt; &amp; natlog10_</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00139">fstutils.applylmonthefly.hpp:139</a></div></div>
<div class="ttc" id="structfst_1_1HackScoreBilingual_html_a514d1f61dc0d249752efc980e1df20d8"><div class="ttname"><a href="structfst_1_1HackScoreBilingual.html#a514d1f61dc0d249752efc980e1df20d8">fst::HackScoreBilingual::operator()</a></div><div class="ttdeci">void operator()(float &amp;w, float &amp;wp, unsigned label, StateT &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00099">fstutils.applylmonthefly.hpp:99</a></div></div>
<div class="ttc" id="namespaceucam_1_1util_html_a0998857de4c50a6e292bdf372be2703f"><div class="ttname"><a href="namespaceucam_1_1util.html#a0998857de4c50a6e292bdf372be2703f">ucam::util::hashfvecuint</a></div><div class="ttdeci">HashFVec&lt; std::basic_string&lt; unsigned &gt; &gt; hashfvecuint</div><div class="ttdef"><b>Definition:</b> <a href="global__funcs_8hpp_source.html#l00220">global_funcs.hpp:220</a></div></div>
<div class="ttc" id="classucam_1_1util_1_1HashEqVec_html"><div class="ttname"><a href="classucam_1_1util_1_1HashEqVec.html">ucam::util::HashEqVec</a></div><div class="ttdef"><b>Definition:</b> <a href="global__funcs_8hpp_source.html#l00194">global_funcs.hpp:194</a></div></div>
<div class="ttc" id="idbridge_8hpp_html"><div class="ttname"><a href="idbridge_8hpp.html">idbridge.hpp</a></div><div class="ttdoc">maps between grammar targets ids and lm ids </div></div>
<div class="ttc" id="structfst_1_1MakeWeight_html"><div class="ttname"><a href="structfst_1_1MakeWeight.html">fst::MakeWeight</a></div><div class="ttdoc">Templated functor that creates a weight given a float. </div><div class="ttdef"><b>Definition:</b> <a href="lexicographic-tropical-tropical-funcs_8h_source.html#l00047">lexicographic-tropical-tropical-funcs.h:47</a></div></div>
<div class="ttc" id="classfst_1_1ApplyLanguageModelOnTheFly_html"><div class="ttname"><a href="classfst_1_1ApplyLanguageModelOnTheFly.html">fst::ApplyLanguageModelOnTheFly</a></div><div class="ttdoc">Class that applies language model on the fly using kenlm. </div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00312">fstutils.applylmonthefly.hpp:312</a></div></div>
<div class="ttc" id="logger_8boost__log_8hpp_html_a6ffaab1d2d66f7f82bb45ce32e7e48e4"><div class="ttname"><a href="logger_8boost__log_8hpp.html#a6ffaab1d2d66f7f82bb45ce32e7e48e4">LWARN</a></div><div class="ttdeci">#define LWARN(msg)</div><div class="ttdef"><b>Definition:</b> <a href="logger_8boost__log_8hpp_source.html#l00125">logger.boost_log.hpp:125</a></div></div>
<div class="ttc" id="structfst_1_1Scale_3_01lm_1_1np_1_1State_01_4_html_aad8edbd4b83dbc6c1a230c03cb50dac1"><div class="ttname"><a href="structfst_1_1Scale_3_01lm_1_1np_1_1State_01_4.html#aad8edbd4b83dbc6c1a230c03cb50dac1">fst::Scale&lt; lm::np::State &gt;::operator()</a></div><div class="ttdeci">float operator()()</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00059">fstutils.applylmonthefly.hpp:59</a></div></div>
<div class="ttc" id="structfst_1_1Scale_html_a143b48d78c9159f86a125a3d808d5abb"><div class="ttname"><a href="structfst_1_1Scale.html#a143b48d78c9159f86a125a3d808d5abb">fst::Scale::operator()</a></div><div class="ttdeci">float operator()()</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00048">fstutils.applylmonthefly.hpp:48</a></div></div>
<div class="ttc" id="structfst_1_1ApplyLanguageModelOnTheFlyInterface_html"><div class="ttname"><a href="structfst_1_1ApplyLanguageModelOnTheFlyInterface.html">fst::ApplyLanguageModelOnTheFlyInterface</a></div><div class="ttdoc">Interface for language model application Provides different run methods to do composition with a (bil...</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00290">fstutils.applylmonthefly.hpp:290</a></div></div>
<div class="ttc" id="structfst_1_1StateHandler_3_01lm_1_1np_1_1State_01_4_html_a02b727f4ffd58d59057efa388769342b"><div class="ttname"><a href="structfst_1_1StateHandler_3_01lm_1_1np_1_1State_01_4.html#a02b727f4ffd58d59057efa388769342b">fst::StateHandler&lt; lm::np::State &gt;::length_</a></div><div class="ttdeci">unsigned length_</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00039">fstutils.applylmonthefly.hpp:39</a></div></div>
<div class="ttc" id="structfst_1_1Scorer_html_a3ca39ca9542c35e072c60220e80aec29"><div class="ttname"><a href="structfst_1_1Scorer.html#a3ca39ca9542c35e072c60220e80aec29">fst::Scorer::hs_</a></div><div class="ttdeci">HackScoreT&lt; StateT &gt; hs_</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00138">fstutils.applylmonthefly.hpp:138</a></div></div>
<div class="ttc" id="structfst_1_1StateHandler_html_acc607cb2f842e4ec200dcfc2f254438b"><div class="ttname"><a href="structfst_1_1StateHandler.html#acc607cb2f842e4ec200dcfc2f254438b">fst::StateHandler::setLength</a></div><div class="ttdeci">void setLength(unsigned length)</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00032">fstutils.applylmonthefly.hpp:32</a></div></div>
<div class="ttc" id="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4_html_a60c3d4a7985e373513d66296b19ebd06"><div class="ttname"><a href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#a60c3d4a7985e373513d66296b19ebd06">fst::Scorer&lt; lm::np::State, lm::np::Model, IdBridgeT, HackScoreT &gt;::lmmodel_</a></div><div class="ttdeci">KenLMModelT &amp; lmmodel_</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00170">fstutils.applylmonthefly.hpp:170</a></div></div>
<div class="ttc" id="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4_html_a32cfff35cc56f2df66729aeb52675e71"><div class="ttname"><a href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#a32cfff35cc56f2df66729aeb52675e71">fst::Scorer&lt; lm::np::State, lm::np::Model, IdBridgeT, HackScoreT &gt;::StateT</a></div><div class="ttdeci">lm::np::State StateT</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00169">fstutils.applylmonthefly.hpp:169</a></div></div>
<div class="ttc" id="namespacefst_html_a44ae4725c7f99b13ab8e3ec44ee60e33"><div class="ttname"><a href="namespacefst.html#a44ae4725c7f99b13ab8e3ec44ee60e33">fst::ZPosInfinity</a></div><div class="ttdeci">float ZPosInfinity()</div><div class="ttdoc">Just a wrapper to maintain compatibility with OpenFST 1.3.1, last version using kPosInfinity constant...</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8hpp_source.html#l00027">fstutils.hpp:27</a></div></div>
<div class="ttc" id="structfst_1_1ApplyLanguageModelOnTheFlyInterface_html_a838eac22ecb4301d2841924343e3399a"><div class="ttname"><a href="structfst_1_1ApplyLanguageModelOnTheFlyInterface.html#a838eac22ecb4301d2841924343e3399a">fst::ApplyLanguageModelOnTheFlyInterface::~ApplyLanguageModelOnTheFlyInterface</a></div><div class="ttdeci">virtual ~ApplyLanguageModelOnTheFlyInterface()</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00297">fstutils.applylmonthefly.hpp:297</a></div></div>
<div class="ttc" id="namespacelm_html"><div class="ttname"><a href="namespacelm.html">lm</a></div><div class="ttdef"><b>Definition:</b> <a href="hifst__enumerate__vocab_8hpp_source.html#l00028">hifst_enumerate_vocab.hpp:28</a></div></div>
<div class="ttc" id="structfst_1_1HackScoreBilingual_html"><div class="ttname"><a href="structfst_1_1HackScoreBilingual.html">fst::HackScoreBilingual</a></div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00098">fstutils.applylmonthefly.hpp:98</a></div></div>
<div class="ttc" id="structfst_1_1HackScoreBilingual_3_01lm_1_1np_1_1State_01_4_html_ab7c40ee234c5a8f9b1f9aa36ebc09986"><div class="ttname"><a href="structfst_1_1HackScoreBilingual_3_01lm_1_1np_1_1State_01_4.html#ab7c40ee234c5a8f9b1f9aa36ebc09986">fst::HackScoreBilingual&lt; lm::np::State &gt;::operator()</a></div><div class="ttdeci">void operator()(float &amp;w, float &amp;wp, unsigned label, lm::np::State &amp;ns)</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00108">fstutils.applylmonthefly.hpp:108</a></div></div>
<div class="ttc" id="classfst_1_1ApplyLanguageModelOnTheFly_html_a55647f5f94e96b628955379977e1831b"><div class="ttname"><a href="classfst_1_1ApplyLanguageModelOnTheFly.html#a55647f5f94e96b628955379977e1831b">fst::ApplyLanguageModelOnTheFly::run</a></div><div class="ttdeci">VectorFst&lt; Arc &gt; * run(const VectorFst&lt; Arc &gt; &amp;fst)</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00427">fstutils.applylmonthefly.hpp:427</a></div></div>
<div class="ttc" id="namespacefst_html_a078df45c8364cd74acdb682726a75151"><div class="ttname"><a href="namespacefst.html#a078df45c8364cd74acdb682726a75151">fst::Times</a></div><div class="ttdeci">TropicalSparseTupleWeight&lt; T &gt; Times(const TropicalSparseTupleWeight&lt; T &gt; &amp;w1, const TropicalSparseTupleWeight&lt; T &gt; &amp;w2)</div><div class="ttdef"><b>Definition:</b> <a href="fsttools_2include_2tropical-sparse-tuple-weight_8h_source.html#l00163">fsttools/include/tropical-sparse-tuple-weight.h:163</a></div></div>
<div class="ttc" id="structfst_1_1Scorer_html_acb88e86f68092eeabac8473cbb025048"><div class="ttname"><a href="structfst_1_1Scorer.html#acb88e86f68092eeabac8473cbb025048">fst::Scorer::idbridge_</a></div><div class="ttdeci">IdBridgeT const &amp; idbridge_</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00136">fstutils.applylmonthefly.hpp:136</a></div></div>
<div class="ttc" id="logger_8boost__log_8hpp_html_ad364e6e39b7970e4548d99dc3c0c68cc"><div class="ttname"><a href="logger_8boost__log_8hpp.html#ad364e6e39b7970e4548d99dc3c0c68cc">LERROR</a></div><div class="ttdeci">#define LERROR(msg)</div><div class="ttdef"><b>Definition:</b> <a href="logger_8boost__log_8hpp_source.html#l00119">logger.boost_log.hpp:119</a></div></div>
<div class="ttc" id="namespacefst_html_af2ba34587e640e012e10b00a65478e72"><div class="ttname"><a href="namespacefst.html#af2ba34587e640e012e10b00a65478e72">fst::printDebug</a></div><div class="ttdeci">std::string printDebug(StateT const &amp;state)</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00122">fstutils.applylmonthefly.hpp:122</a></div></div>
<div class="ttc" id="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4_html_a58654533046422080b1f26f1c0ef75c5"><div class="ttname"><a href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#a58654533046422080b1f26f1c0ef75c5">fst::Scorer&lt; lm::np::State, lm::np::Model, IdBridgeT, HackScoreT &gt;::srcSize_</a></div><div class="ttdeci">unsigned srcSize_</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00173">fstutils.applylmonthefly.hpp:173</a></div></div>
<div class="ttc" id="structfst_1_1HackScore_html_aecd286f5fa7a690fa0a6e9bd4aa1d004"><div class="ttname"><a href="structfst_1_1HackScore.html#aecd286f5fa7a690fa0a6e9bd4aa1d004">fst::HackScore::operator()</a></div><div class="ttdeci">void operator()(float &amp;w, float &amp;wp, unsigned label, StateT &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00071">fstutils.applylmonthefly.hpp:71</a></div></div>
<div class="ttc" id="structfst_1_1Scorer_html"><div class="ttname"><a href="structfst_1_1Scorer.html">fst::Scorer</a></div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00135">fstutils.applylmonthefly.hpp:135</a></div></div>
<div class="ttc" id="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4_html_a6ede9e8ea0d7cf302a36fe08b5f72575"><div class="ttname"><a href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#a6ede9e8ea0d7cf302a36fe08b5f72575">fst::Scorer&lt; lm::np::State, lm::np::Model, IdBridgeT, HackScoreT &gt;::hs_</a></div><div class="ttdeci">HackScoreT&lt; StateT &gt; hs_</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00171">fstutils.applylmonthefly.hpp:171</a></div></div>
<div class="ttc" id="classfst_1_1ApplyLanguageModelOnTheFly_html_a34ec16b4f30e6bb6e9a10e1b59a7e431"><div class="ttname"><a href="classfst_1_1ApplyLanguageModelOnTheFly.html#a34ec16b4f30e6bb6e9a10e1b59a7e431">fst::ApplyLanguageModelOnTheFly::run</a></div><div class="ttdeci">VectorFst&lt; Arc &gt; * run(const VectorFst&lt; Arc &gt; &amp;fst, unordered_set&lt; Label &gt; const &amp;epsilons)</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00430">fstutils.applylmonthefly.hpp:430</a></div></div>
<div class="ttc" id="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4_html_a362fa2a45c32f16f64ae399b744378bb"><div class="ttname"><a href="structfst_1_1Scorer_3_01lm_1_1np_1_1State_00_01lm_1_1np_1_1Model_00_01IdBridgeT_00_01HackScoreT_01_4.html#a362fa2a45c32f16f64ae399b744378bb">fst::Scorer&lt; lm::np::State, lm::np::Model, IdBridgeT, HackScoreT &gt;::srcWindows_</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; unsigned &gt; &gt; srcWindows_</div><div class="ttdef"><b>Definition:</b> <a href="fstutils_8applylmonthefly_8hpp_source.html#l00175">fstutils.applylmonthefly.hpp:175</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_701c0c8b41b031e69113781f2f4e5321.html">ucam-smt</a></li><li class="navelem"><a class="el" href="dir_6c232e806e8d6cc2bbc4c32b14734fc5.html">cpp</a></li><li class="navelem"><a class="el" href="dir_db4241a08a3f066709bb61abf4b99f1e.html">fsttools</a></li><li class="navelem"><a class="el" href="dir_cfe80d0fe975d76ea8f1a64423722e9d.html">include</a></li><li class="navelem"><a class="el" href="fstutils_8applylmonthefly_8hpp.html">fstutils.applylmonthefly.hpp</a></li>
    <li class="footer">Generated on Thu May 19 2016 11:21:35 for Cambridge SMT System by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
