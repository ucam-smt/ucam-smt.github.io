

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>cam.sgnmt.blocks.alignment package &mdash; SGNMT 0.3.2 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
    <link rel="top" title="SGNMT 0.3.2 documentation" href="index.html"/>
        <link rel="up" title="cam.sgnmt.blocks package" href="cam.sgnmt.blocks.html"/>
        <link rel="next" title="cam.sgnmt.decoding package" href="cam.sgnmt.decoding.html"/>
        <link rel="prev" title="cam.sgnmt.blocks package" href="cam.sgnmt.blocks.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> SGNMT
          

          
          </a>

          
            
            
              <div class="version">
                0.3.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="setup.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial: Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="adding_components.html">Tutorial: Adding new components</a></li>
<li class="toctree-l1"><a class="reference internal" href="kyoto_nmt.html">Tutorial:  NMT decoding strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_line.html">Command-line reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="predictors.html">Predictors</a></li>
<li class="toctree-l1"><a class="reference internal" href="decoders.html">Decoders</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Common issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="cam.sgnmt.html">All modules</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="cam.sgnmt.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="cam.sgnmt.blocks.html">cam.sgnmt.blocks package</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="cam.sgnmt.blocks.html#subpackages">Subpackages</a></li>
<li class="toctree-l4"><a class="reference internal" href="cam.sgnmt.blocks.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="cam.sgnmt.blocks.html#cam-sgnmt-blocks-align-module">cam.sgnmt.blocks.align module</a></li>
<li class="toctree-l4"><a class="reference internal" href="cam.sgnmt.blocks.html#module-cam.sgnmt.blocks.attention">cam.sgnmt.blocks.attention module</a></li>
<li class="toctree-l4"><a class="reference internal" href="cam.sgnmt.blocks.html#cam-sgnmt-blocks-batch-decode-module">cam.sgnmt.blocks.batch_decode module</a></li>
<li class="toctree-l4"><a class="reference internal" href="cam.sgnmt.blocks.html#module-cam.sgnmt.blocks.checkpoint">cam.sgnmt.blocks.checkpoint module</a></li>
<li class="toctree-l4"><a class="reference internal" href="cam.sgnmt.blocks.html#module-cam.sgnmt.blocks.decoder">cam.sgnmt.blocks.decoder module</a></li>
<li class="toctree-l4"><a class="reference internal" href="cam.sgnmt.blocks.html#module-cam.sgnmt.blocks.encoder">cam.sgnmt.blocks.encoder module</a></li>
<li class="toctree-l4"><a class="reference internal" href="cam.sgnmt.blocks.html#module-cam.sgnmt.blocks.model">cam.sgnmt.blocks.model module</a></li>
<li class="toctree-l4"><a class="reference internal" href="cam.sgnmt.blocks.html#module-cam.sgnmt.blocks.nmt">cam.sgnmt.blocks.nmt module</a></li>
<li class="toctree-l4"><a class="reference internal" href="cam.sgnmt.blocks.html#module-cam.sgnmt.blocks.pruning">cam.sgnmt.blocks.pruning module</a></li>
<li class="toctree-l4"><a class="reference internal" href="cam.sgnmt.blocks.html#module-cam.sgnmt.blocks.sampling">cam.sgnmt.blocks.sampling module</a></li>
<li class="toctree-l4"><a class="reference internal" href="cam.sgnmt.blocks.html#module-cam.sgnmt.blocks.sparse_search">cam.sgnmt.blocks.sparse_search module</a></li>
<li class="toctree-l4"><a class="reference internal" href="cam.sgnmt.blocks.html#module-cam.sgnmt.blocks.stream">cam.sgnmt.blocks.stream module</a></li>
<li class="toctree-l4"><a class="reference internal" href="cam.sgnmt.blocks.html#cam-sgnmt-blocks-train-module">cam.sgnmt.blocks.train module</a></li>
<li class="toctree-l4"><a class="reference internal" href="cam.sgnmt.blocks.html#module-cam.sgnmt.blocks.vanilla_decoder">cam.sgnmt.blocks.vanilla_decoder module</a></li>
<li class="toctree-l4"><a class="reference internal" href="cam.sgnmt.blocks.html#module-cam.sgnmt.blocks">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cam.sgnmt.decoding.html">cam.sgnmt.decoding package</a></li>
<li class="toctree-l3"><a class="reference internal" href="cam.sgnmt.misc.html">cam.sgnmt.misc package</a></li>
<li class="toctree-l3"><a class="reference internal" href="cam.sgnmt.predictors.html">cam.sgnmt.predictors package</a></li>
<li class="toctree-l3"><a class="reference internal" href="cam.sgnmt.tf.html">cam.sgnmt.tf package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cam.sgnmt.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="cam.sgnmt.html#cam-sgnmt-decode-module">cam.sgnmt.decode module</a></li>
<li class="toctree-l2"><a class="reference internal" href="cam.sgnmt.html#module-cam.sgnmt.decode_utils">cam.sgnmt.decode_utils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="cam.sgnmt.html#cam-sgnmt-extract-scores-along-reference-module">cam.sgnmt.extract_scores_along_reference module</a></li>
<li class="toctree-l2"><a class="reference internal" href="cam.sgnmt.html#module-cam.sgnmt.output">cam.sgnmt.output module</a></li>
<li class="toctree-l2"><a class="reference internal" href="cam.sgnmt.html#module-cam.sgnmt.ui">cam.sgnmt.ui module</a></li>
<li class="toctree-l2"><a class="reference internal" href="cam.sgnmt.html#module-cam.sgnmt.utils">cam.sgnmt.utils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="cam.sgnmt.html#module-cam.sgnmt">Module contents</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">SGNMT</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="cam.sgnmt.html">cam.sgnmt package</a> &raquo;</li>
      
          <li><a href="cam.sgnmt.blocks.html">cam.sgnmt.blocks package</a> &raquo;</li>
      
    <li>cam.sgnmt.blocks.alignment package</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/cam.sgnmt.blocks.alignment.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cam-sgnmt-blocks-alignment-package">
<h1>cam.sgnmt.blocks.alignment package<a class="headerlink" href="#cam-sgnmt-blocks-alignment-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-cam.sgnmt.blocks.alignment.nam">
<span id="cam-sgnmt-blocks-alignment-nam-module"></span><h2>cam.sgnmt.blocks.alignment.nam module<a class="headerlink" href="#module-cam.sgnmt.blocks.alignment.nam" title="Permalink to this headline">¶</a></h2>
<p>This module implements the Neural Alignment Model (NAM). The NAM
uses the same architecture as normal NMT, but replaces the attention
model with a trainable alignment matrix. The alignment model reloads
NMT weight matrices trained with <code class="docutils literal"><span class="pre">nmt.train</span></code> except the ones in the
attention sub-network. To align a sentence pair, we initialize the
alignment matrix randomly, and run several iterations of SGD in which
we fix all parameters (i.e. weight matrices loaded from the NMT model)
except the newly added alignment matrix.</p>
<p>We implemented this workflow using the MainLoop framework in blocks.
The data stream emits the same sentence pair until it is explicitly
requested by <code class="docutils literal"><span class="pre">NextSentenceExtension</span></code> to switch to the next pair.</p>
<dl class="class">
<dt id="cam.sgnmt.blocks.alignment.nam.ExplicitNext">
<em class="property">class </em><code class="descclassname">cam.sgnmt.blocks.alignment.nam.</code><code class="descname">ExplicitNext</code><span class="sig-paren">(</span><em>data_stream</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cam/sgnmt/blocks/alignment/nam.html#ExplicitNext"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cam.sgnmt.blocks.alignment.nam.ExplicitNext" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">fuel.transformers.Transformer</span></code></p>
<p>This data transformer outputs the same data until it is
explicitly iterated by calling <code class="docutils literal"><span class="pre">switch_to_next_data()</span></code></p>
<dl class="method">
<dt id="cam.sgnmt.blocks.alignment.nam.ExplicitNext.get_data">
<code class="descname">get_data</code><span class="sig-paren">(</span><em>request=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cam/sgnmt/blocks/alignment/nam.html#ExplicitNext.get_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cam.sgnmt.blocks.alignment.nam.ExplicitNext.get_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns <code class="docutils literal"><span class="pre">self.current_data</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="cam.sgnmt.blocks.alignment.nam.ExplicitNext.switch_to_next_data">
<code class="descname">switch_to_next_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/cam/sgnmt/blocks/alignment/nam.html#ExplicitNext.switch_to_next_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cam.sgnmt.blocks.alignment.nam.ExplicitNext.switch_to_next_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Switch to the next data given by the child data stream</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cam.sgnmt.blocks.alignment.nam.NextSentenceExtension">
<em class="property">class </em><code class="descclassname">cam.sgnmt.blocks.alignment.nam.</code><code class="descname">NextSentenceExtension</code><span class="sig-paren">(</span><em>align_stream</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cam/sgnmt/blocks/alignment/nam.html#NextSentenceExtension"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cam.sgnmt.blocks.alignment.nam.NextSentenceExtension" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">blocks.extensions.SimpleExtension</span></code></p>
<p>This Blocks extension is invoked each <code class="docutils literal"><span class="pre">--iterations</span></code> batches.
It saves the previous alignment matrix, resets the matrix in the
computation graph, and iterates to the next sentence pair.</p>
<dl class="method">
<dt id="cam.sgnmt.blocks.alignment.nam.NextSentenceExtension.do">
<code class="descname">do</code><span class="sig-paren">(</span><em>which_callback</em>, <em>*args</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cam/sgnmt/blocks/alignment/nam.html#NextSentenceExtension.do"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cam.sgnmt.blocks.alignment.nam.NextSentenceExtension.do" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is called from the MainLoop in blocks and
handles all the work which has to be done after aligning a
sentence pair. This involves:</p>
<blockquote>
<div><ul class="simple">
<li>Fetching the alignment matrix from the computation graph
and append it to the <code class="docutils literal"><span class="pre">alignments</span></code> global</li>
<li>Call the data stream s.t. it iterates to the next sentence
pair</li>
<li>Override the current value of the alignment matrix variable
with its initial value to get a fresh start for the next
optimization</li>
</ul>
</div></blockquote>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cam.sgnmt.blocks.alignment.nam.PrintCurrentLogRow">
<em class="property">class </em><code class="descclassname">cam.sgnmt.blocks.alignment.nam.</code><code class="descname">PrintCurrentLogRow</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cam/sgnmt/blocks/alignment/nam.html#PrintCurrentLogRow"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cam.sgnmt.blocks.alignment.nam.PrintCurrentLogRow" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">blocks.extensions.SimpleExtension</span></code></p>
<p>This extension prints the current log row to the screen.</p>
<dl class="method">
<dt id="cam.sgnmt.blocks.alignment.nam.PrintCurrentLogRow.do">
<code class="descname">do</code><span class="sig-paren">(</span><em>which_callback</em>, <em>*args</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cam/sgnmt/blocks/alignment/nam.html#PrintCurrentLogRow.do"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cam.sgnmt.blocks.alignment.nam.PrintCurrentLogRow.do" title="Permalink to this definition">¶</a></dt>
<dd><p>Prints the current log status on the screen</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="cam.sgnmt.blocks.alignment.nam.align_with_nam">
<code class="descclassname">cam.sgnmt.blocks.alignment.nam.</code><code class="descname">align_with_nam</code><span class="sig-paren">(</span><em>config</em>, <em>args</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cam/sgnmt/blocks/alignment/nam.html#align_with_nam"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cam.sgnmt.blocks.alignment.nam.align_with_nam" title="Permalink to this definition">¶</a></dt>
<dd><p>Main method for using the Neural Alignment Model.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>config</strong> (<em>dict</em>) &#8211; NMT configuration</li>
<li><strong>args</strong> (<em>object</em>) &#8211; ArgumentParser object containing the command
line arguments</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">list. List of alignments, where alignments are represented as
numpy matrices containing confidences between 0 and 1.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="data">
<dt id="cam.sgnmt.blocks.alignment.nam.alignments">
<code class="descclassname">cam.sgnmt.blocks.alignment.nam.</code><code class="descname">alignments</code><em class="property"> = []</em><a class="headerlink" href="#cam.sgnmt.blocks.alignment.nam.alignments" title="Permalink to this definition">¶</a></dt>
<dd><p>Global variable for collecting the alignments.</p>
</dd></dl>

</div>
<div class="section" id="module-cam.sgnmt.blocks.alignment.nmt">
<span id="cam-sgnmt-blocks-alignment-nmt-module"></span><h2>cam.sgnmt.blocks.alignment.nmt module<a class="headerlink" href="#module-cam.sgnmt.blocks.alignment.nmt" title="Permalink to this headline">¶</a></h2>
<p>This module implements word alignment with the standard attentional
NMT architecture according Bahdanau et. al., 2015. It relies on the
predictor framework to perform forced NMT decoding and captures the
alignment weights during this process. The alignment weights are then
interpreted as alignment link strengths.</p>
<dl class="function">
<dt id="cam.sgnmt.blocks.alignment.nmt.align_with_nmt">
<code class="descclassname">cam.sgnmt.blocks.alignment.nmt.</code><code class="descname">align_with_nmt</code><span class="sig-paren">(</span><em>config</em>, <em>args</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cam/sgnmt/blocks/alignment/nmt.html#align_with_nmt"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cam.sgnmt.blocks.alignment.nmt.align_with_nmt" title="Permalink to this definition">¶</a></dt>
<dd><p>Main method for NMT based alignment. Aligns the corpus using the
alignment weights from NMT forced decoding.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>config</strong> (<em>dict</em>) &#8211; NMT configuration</li>
<li><strong>args</strong> (<em>object</em>) &#8211; ArgumentParser object containing the command
line arguments</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">list. List of alignments, where alignments are represented as
numpy matrices containing confidences between 0 and 1.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-cam.sgnmt.blocks.alignment">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-cam.sgnmt.blocks.alignment" title="Permalink to this headline">¶</a></h2>
<p>This package contains neural alignment models. Modules in this
package should implement a method <code class="docutils literal"><span class="pre">align_with_*</span></code> which serves as the
entry point to the module and can be called from <code class="docutils literal"><span class="pre">align.py</span></code>.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cam.sgnmt.decoding.html" class="btn btn-neutral float-right" title="cam.sgnmt.decoding package" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cam.sgnmt.blocks.html" class="btn btn-neutral" title="cam.sgnmt.blocks package" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, University of Cambridge.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.3.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>